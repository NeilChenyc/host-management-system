# ğŸš€ Agentå¿«é€Ÿå¼€å§‹ï¼ˆ5åˆ†é’Ÿæå®šï¼‰

## ğŸ“‹ å‰ç½®æ¡ä»¶

- âœ… Python 3.8+
- âœ… Spring Bootåç«¯æ­£åœ¨è¿è¡Œï¼ˆlocalhost:8080ï¼‰
- âœ… åœ¨å¹³å°ä¸­å·²æ·»åŠ è‡³å°‘ä¸€å°æœåŠ¡å™¨

---

## âš¡ 3æ­¥å¯åŠ¨

### ç¬¬1æ­¥ï¼šå®‰è£…ä¾èµ–ï¼ˆ1åˆ†é’Ÿï¼‰

```bash
pip3 install psutil requests
```

**éªŒè¯å®‰è£…ï¼š**
```bash
python3 -c "import psutil, requests; print('OK')"
```

---

### ç¬¬2æ­¥ï¼šé…ç½®Agentï¼ˆ1åˆ†é’Ÿï¼‰

ç¼–è¾‘ `agent_config.json`ï¼š

```json
{
  "platform_url": "http://localhost:8080/api/servers/metrics/collect",
  "server_id": 1,
  "interval": 60
}
```

**é‡è¦ï¼š** 
- ç¡®ä¿ `server_id` æ˜¯å¹³å°ä¸­å­˜åœ¨çš„æœåŠ¡å™¨ID
- æœ¬åœ°æµ‹è¯•ç”¨ `localhost`ï¼Œè¿œç¨‹ç”¨å®é™…IP

---

### ç¬¬3æ­¥ï¼šå¯åŠ¨Agentï¼ˆ1åˆ†é’Ÿï¼‰

```bash
python3 server_agent.py
```

**çœ‹åˆ°è¿™ä¸ªå°±æˆåŠŸäº†ï¼š**
```
======================================================================
                 æœåŠ¡å™¨ç›‘æ§Agent
======================================================================
æœåŠ¡å™¨ID:        1
å¹³å°åœ°å€:        http://localhost:8080/api/servers/metrics/collect
é‡‡é›†é—´éš”:        60 ç§’
======================================================================

Agentå¯åŠ¨æˆåŠŸï¼Œå¼€å§‹ç›‘æ§...

==================================================
é‡‡é›†æ—¶é—´: 2024-01-15 10:30:15
  CPUä½¿ç”¨ç‡:    45.2%
  å†…å­˜ä½¿ç”¨ç‡:   68.5%
  ç£ç›˜ä½¿ç”¨ç‡:   72.3%
âœ“ æŒ‡æ ‡æ¨é€æˆåŠŸ (HTTP 200)
```

---

## âœ… éªŒè¯æ•°æ®

### æ–¹æ³•1ï¼šä½¿ç”¨Swaggerï¼ˆæ¨èï¼‰

1. æ‰“å¼€ `http://localhost:8080/swagger-ui.html`
2. æ‰¾åˆ° `GET /api/servers/{serverId}/metrics/latest`
3. è¾“å…¥ `1`ï¼ˆä½ çš„server_idï¼‰
4. ç‚¹å‡» "Execute"
5. çœ‹åˆ°æœ€æ–°çš„æŒ‡æ ‡æ•°æ®

### æ–¹æ³•2ï¼šç›´æ¥æŸ¥è¯¢æ•°æ®åº“

```sql
SELECT * FROM server_metrics 
WHERE server_id = 1 
ORDER BY collected_at DESC 
LIMIT 1;
```

### æ–¹æ³•3ï¼šå‰ç«¯Dashboard

1. è®¿é—® `http://localhost:3000`ï¼ˆå¦‚æœå‰ç«¯å·²å¯åŠ¨ï¼‰
2. è¿›å…¥Dashboard
3. æŸ¥çœ‹æœåŠ¡å™¨æŒ‡æ ‡

---

## ğŸ¬ Demoæ¼”ç¤ºæŠ€å·§

### å±•ç¤ºå®æ—¶æ€§

**æ–¹æ³•1ï¼šè¿è¡Œç¨‹åº**
1. å¯åŠ¨Agentï¼ˆCPUä½¿ç”¨ç‡è¾ƒä½ï¼‰
2. æ‰“å¼€ä»»åŠ¡ç®¡ç†å™¨
3. è¿è¡Œä¸€ä¸ªCPUå¯†é›†å‹ç¨‹åºï¼ˆå¦‚è§†é¢‘æ¸²æŸ“ï¼‰
4. ç­‰å¾…1åˆ†é’Ÿ
5. çœ‹Agentè¾“å‡ºCPUä½¿ç”¨ç‡ä¸Šå‡
6. åœ¨Dashboardçœ‹åˆ°å˜åŒ–

**æ–¹æ³•2ï¼šä½¿ç”¨æµ‹è¯•è„šæœ¬**
```python
# cpu_stress.py - å ç”¨CPUçš„æµ‹è¯•è„šæœ¬
while True:
    pass
```

è¿è¡Œï¼š
```bash
python3 cpu_stress.py
```

---

## âŒ å¸¸è§é—®é¢˜é€ŸæŸ¥

| é—®é¢˜ | è§£å†³æ–¹æ³• |
|------|---------|
| `ModuleNotFoundError: psutil` | `pip3 install psutil requests` |
| `è¿æ¥å¤±è´¥` | æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œåœ¨8080ç«¯å£ |
| `HTTP 400` | æ£€æŸ¥server_idæ˜¯å¦å­˜åœ¨ |
| `HTTP 500` | æŸ¥çœ‹åç«¯æ—¥å¿— |
| æ¸©åº¦ä¸ºnull | Windowsä¸æ”¯æŒï¼Œæ­£å¸¸ç°è±¡ |

---

## ğŸ›‘ åœæ­¢Agent

**å‰å°è¿è¡Œ:** æŒ‰ `Ctrl+C`

**åå°è¿è¡Œ:**
```bash
# æ‰¾åˆ°è¿›ç¨‹
ps aux | grep server_agent.py

# åœæ­¢è¿›ç¨‹
kill <PID>
```

---

## ğŸ“Š å®Œæ•´æµ‹è¯•æµç¨‹

```bash
# 1. å¯åŠ¨åç«¯ï¼ˆæ–°ç»ˆç«¯1ï¼‰
cd backend
./mvnw spring-boot:run

# 2. å¯åŠ¨å‰ç«¯ï¼ˆæ–°ç»ˆç«¯2ï¼Œå¯é€‰ï¼‰
cd frontend
npm run dev

# 3. å®‰è£…ä¾èµ–ï¼ˆæ–°ç»ˆç«¯3ï¼‰
pip3 install psutil requests

# 4. å¯åŠ¨Agentï¼ˆæ–°ç»ˆç«¯3ï¼‰
python3 server_agent.py

# 5. éªŒè¯ï¼ˆæµè§ˆå™¨ï¼‰
# è®¿é—® http://localhost:8080/swagger-ui.html
# æˆ– http://localhost:3000
```

---

## ğŸ¯ æˆåŠŸæ ‡å¿—

- âœ… Agentæ¯60ç§’è¾“å‡ºä¸€æ¬¡æ•°æ®
- âœ… æ˜¾ç¤º "âœ“ æŒ‡æ ‡æ¨é€æˆåŠŸ (HTTP 200)"
- âœ… Swaggerèƒ½æŸ¥åˆ°æœ€æ–°æ•°æ®
- âœ… æ•°æ®åº“æœ‰æ–°è®°å½•

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

æ£€æŸ¥ï¼š
1. åç«¯æ˜¯å¦è¿è¡Œï¼Ÿ `curl http://localhost:8080/actuator/health`
2. æœåŠ¡å™¨IDæ˜¯å¦å­˜åœ¨ï¼ŸæŸ¥çœ‹serversè¡¨
3. é…ç½®æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼ŸJSONæ ¼å¼æ£€æŸ¥
4. é˜²ç«å¢™æ˜¯å¦é˜»æ­¢ï¼Ÿå°è¯•å…³é—­é˜²ç«å¢™æµ‹è¯•

---

**æ­å–œï¼ä½ çš„ç›‘æ§ç³»ç»Ÿå·²ç»è¿è¡Œèµ·æ¥äº†ï¼** ğŸ‰

