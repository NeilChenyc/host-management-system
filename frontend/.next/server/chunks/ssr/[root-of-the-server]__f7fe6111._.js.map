{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///D:/A_%E5%AD%A6%E4%B9%A0%E6%96%87%E4%BB%B6/5619/ELEC5619-03-Group-1/frontend/src/lib/auth.ts"],"sourcesContent":["// Authentication utilities for JWT token management and permission verification\r\nimport axios from 'axios';\r\n\r\n// API base URL used for frontend-to-backend requests.\r\n// Prefer reading from environment variable NEXT_PUBLIC_API_BASE_URL so you can easily switch between dev/staging/prod.\r\n// Fallback to Spring Boot's common default port (8080) when not provided.\r\n//设置默认请求地址为localhost:8080/api\r\nconst API_BASE_URL = (typeof process !== 'undefined' && process.env.NEXT_PUBLIC_API_BASE_URL)\r\n  ? `${process.env.NEXT_PUBLIC_API_BASE_URL}/api`\r\n  : 'http://localhost:8080/api';\r\n\r\nexport interface User {\r\n  id: string;\r\n  username: string;\r\n  name: string;\r\n  email: string;\r\n  role: 'admin' | 'operator' | 'viewer';\r\n  department?: string;\r\n  permissions: string[];\r\n  avatar?: string;\r\n}\r\n\r\nexport interface AuthState {\r\n  isAuthenticated: boolean;\r\n  user: User | null;\r\n  token: string | null;\r\n}\r\n\r\n// Role-based permissions mapping\r\nexport const ROLE_PERMISSIONS = {\r\n  admin: [\r\n    'user:read', 'user:write', 'user:delete',\r\n    'device:read', 'device:write', 'device:delete',\r\n    'project:read', 'project:write', 'project:delete',\r\n    'service:read', 'service:write', 'service:delete',\r\n    'monitoring:read', 'monitoring:write',\r\n    'alert:read', 'alert:write', 'alert:delete',\r\n    'system:read', 'system:write'\r\n  ],\r\n  operator: [\r\n    'user:read',\r\n    'device:read', 'device:write',\r\n    'project:read', 'project:write',\r\n    'service:read', 'service:write',\r\n    'monitoring:read',\r\n    'alert:read', 'alert:write'\r\n  ],\r\n  viewer: [\r\n    'user:read',\r\n    'device:read',\r\n    'project:read',\r\n    'service:read',\r\n    'monitoring:read',\r\n    'alert:read'\r\n  ]\r\n};\r\n\r\n// Token management\r\nexport class AuthManager {\r\n  private static readonly TOKEN_KEY = 'auth_token';\r\n  private static readonly USER_KEY = 'auth_user';\r\n  private static readonly REFRESH_TOKEN_KEY = 'refresh_token';\r\n\r\n  // Get stored token\r\n  static getToken(): string | null {\r\n    if (typeof window === 'undefined') return null;\r\n    return localStorage.getItem(this.TOKEN_KEY);\r\n  }\r\n\r\n  // Set token\r\n  static setToken(token: string): void {\r\n    if (typeof window === 'undefined') return;\r\n    localStorage.setItem(this.TOKEN_KEY, token);\r\n  }\r\n\r\n  // Remove token\r\n  static removeToken(): void {\r\n    if (typeof window === 'undefined') return;\r\n    localStorage.removeItem(this.TOKEN_KEY);\r\n    localStorage.removeItem(this.USER_KEY);\r\n    localStorage.removeItem(this.REFRESH_TOKEN_KEY);\r\n  }\r\n\r\n  // Get stored user\r\n  static getUser(): User | null {\r\n    if (typeof window === 'undefined') return null;\r\n    const userStr = localStorage.getItem(this.USER_KEY);\r\n    if (!userStr) return null;\r\n    \r\n    try {\r\n      const user = JSON.parse(userStr);\r\n      // Add permissions based on role\r\n      user.permissions = ROLE_PERMISSIONS[user.role as keyof typeof ROLE_PERMISSIONS] || [];\r\n      return user;\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // Set user\r\n  static setUser(user: User): void {\r\n    if (typeof window === 'undefined') return;\r\n    localStorage.setItem(this.USER_KEY, JSON.stringify(user));\r\n  }\r\n\r\n  // Check if token is expired\r\n  /**\r\n   * Check if a JWT token is expired.\r\n   * This version is defensive: if the token is not a valid JWT (e.g., a mock token without three parts),\r\n   * it will assume the token is NOT expired to avoid accidental logout in demo mode.\r\n   *\r\n   * Why: Our backend's mock /signin returns \"mock-jwt-token\" for testing, which is not a real JWT,\r\n   * and the previous implementation would treat it as expired immediately.\r\n   */\r\n  static isTokenExpired(token: string): boolean {\r\n    try {\r\n      const parts = token.split('.');\r\n      // If token is not in JWT format (header.payload.signature), treat it as not expired\r\n      if (parts.length !== 3) {\r\n        return false;\r\n      }\r\n      const payload = JSON.parse(atob(parts[1]));\r\n      const currentTime = Date.now() / 1000;\r\n      // If payload.exp exists and is a number, compare with current time; otherwise assume not expired\r\n      return typeof payload.exp === 'number' ? payload.exp < currentTime : false;\r\n    } catch {\r\n      // On any parsing error, assume not expired to keep user logged in\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // Check if user is authenticated\r\n  static isAuthenticated(): boolean {\r\n    const token = this.getToken();\r\n    if (!token) return false;\r\n    \r\n    if (this.isTokenExpired(token)) {\r\n      this.removeToken();\r\n      return false;\r\n    }\r\n    \r\n    return true;\r\n  }\r\n\r\n  // Get current auth state\r\n  static getAuthState(): AuthState {\r\n    const token = this.getToken();\r\n    const user = this.getUser();\r\n    const isAuthenticated = this.isAuthenticated();\r\n    \r\n    return {\r\n      isAuthenticated,\r\n      user: isAuthenticated ? user : null,\r\n      token: isAuthenticated ? token : null\r\n    };\r\n  }\r\n\r\n  // Login\r\n  /**\r\n   * Perform login by calling backend API and storing JWT + user info locally.\r\n   *\r\n   * Flow:\r\n   * 1) Try POST `${API_BASE_URL}/auth/signin` with { username, password }.\r\n   *    - Expected response (JwtResponseDto): { token, type, id, username, email, roles }\r\n   *    - Save token to localStorage; map backend roles (e.g., ROLE_ADMIN/ROLE_OPERATOR/ROLE_USER)\r\n   *      to our app roles ('admin' | 'operator' | 'viewer') and assign permissions.\r\n   * 2) If /auth/signin fails (e.g., backend not ready), fall back to POST `${API_BASE_URL}/auth/login`.\r\n   *    - This endpoint returns a simple success flag. We'll store a mock token and basic user info so\r\n   *      the rest of the app can run for demo/testing.\r\n   *\r\n   * Returns: { success, message, user? }\r\n   */\r\n  static async login(username: string, password: string): Promise<{ success: boolean; message: string; user?: User }> {\r\n    try {\r\n      // Attempt real signin endpoint first\r\n      //使用axios发送POST请求 \r\n      const res = await axios.post(`${API_BASE_URL}/auth/signin`, {\r\n        username,\r\n        password\r\n      }, {\r\n        headers: { 'Content-Type': 'application/json' }\r\n      });\r\n\r\n      const data: any = res.data || {};\r\n      const token: string | undefined = data.token;\r\n\r\n      // 2.1) 如果后端没有返回 token，视为失败并给出清晰的提示（这在联调早期很常见）\r\n      if (!token) {\r\n        return { success: false, message: 'Login failed: token is missing in server response.' };\r\n      }\r\n\r\n      // 2.2) 角色数组（如 [\"ROLE_USER\", \"ROLE_ADMIN\"]），用于前端权限映射\r\n      const roles: string[] = Array.isArray(data.roles) ? data.roles : [];\r\n\r\n      // Map backend roles to frontend roles used in our app\r\n      const mappedRole: 'admin' | 'operator' | 'viewer' =\r\n        roles.includes('ROLE_ADMIN') ? 'admin' :\r\n        roles.includes('ROLE_OPERATOR') ? 'operator' :\r\n        'viewer';\r\n\r\n      const user: User = {\r\n        id: String(data.id ?? '1'),\r\n        username: data.username ?? username,\r\n        name: data.username ?? username,\r\n        email: data.email ?? `${username}@example.com`,\r\n        role: mappedRole,\r\n        permissions: ROLE_PERMISSIONS[mappedRole]\r\n      };\r\n\r\n      // Persist token and user\r\n      this.setToken(token);\r\n      this.setUser(user);\r\n\r\n      return { success: true, message: 'Login successful', user };\r\n    } catch (error: any) {\r\n      // 捕获失败并尽可能提取后端返回的详细错误信息\r\n      // error.response：后端有响应（例如 400/401/500 等）\r\n      // error.request：请求发出但未收到响应（网络/跨域/后端未启动）\r\n      // error.message：Axios/JS 层面的错误消息\r\n      let detailedMessage = 'Login failed. Please check your credentials or server status.';\r\n\r\n      if (error?.response) {\r\n        const status: number = error.response.status;\r\n        const data = error.response.data;\r\n\r\n        // 尝试从后端响应体中提取错误信息字段\r\n        const serverMsg = typeof data === 'string'\r\n          ? data\r\n          : (data?.message || data?.error || data?.detail || '');\r\n\r\n        if (status === 401) {\r\n          detailedMessage = serverMsg || 'Invalid username or password.';\r\n        } else if (status === 400) {\r\n          detailedMessage = serverMsg || 'Bad request. Please verify the input format.';\r\n        } else if (status >= 500) {\r\n          detailedMessage = serverMsg || 'Server error. Please try again later.';\r\n        } else {\r\n          detailedMessage = serverMsg || `Request failed with status ${status}.`;\r\n        }\r\n      } else if (error?.request) {\r\n        // 请求已发出但没有收到响应（大多是网络问题或后端未启动/地址不对）\r\n        detailedMessage = 'Unable to reach the server. Please confirm the backend is running and NEXT_PUBLIC_API_BASE_URL is correct.';\r\n      } else if (error?.message) {\r\n        // 其他 Axios/JS 层面错误\r\n        detailedMessage = error.message;\r\n      }\r\n\r\n      return { success: false, message: detailedMessage };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Register a new user by calling the backend signup API.\r\n   *\r\n   * What it does:\r\n   * - Sends a POST request to `${API_BASE_URL}/auth/signup` with { username, email, password }.\r\n   * - Expects the backend to return a `UserResponseDto` (id, username, email, roles, ...).\r\n   * - Maps backend roles (e.g., ROLE_ADMIN/ROLE_OPERATOR/ROLE_USER) to our app roles\r\n   *   ('admin' | 'operator' | 'viewer'), and prepares a `User` object for UI feedback.\r\n   * - Does NOT log the user in automatically; the caller should redirect to the login page.\r\n   *\r\n   * Error handling:\r\n   * - Provides detailed error messages based on HTTP status codes and server response body.\r\n   * - Common cases: 400 (validation), 409 (conflict), 500 (server errors).\r\n   *\r\n   * Returns: { success, message, user? }\r\n   */\r\n  static async register(payload: { username: string; email: string; password: string; roles?: string[] }): Promise<{ success: boolean; message: string; user?: User }> {\r\n    try {\r\n      const res = await axios.post(`${API_BASE_URL}/auth/signup`, payload, {\r\n        headers: { 'Content-Type': 'application/json' }\r\n      });\r\n\r\n      const data: any = res.data || {};\r\n      const rolesFromServer: string[] = Array.isArray(data.roles) ? data.roles : [];\r\n\r\n      const mappedRole: 'admin' | 'operator' | 'viewer' =\r\n        rolesFromServer.includes('ROLE_ADMIN') ? 'admin' :\r\n        rolesFromServer.includes('ROLE_OPERATOR') ? 'operator' :\r\n        'viewer';\r\n\r\n      const user: User = {\r\n        id: String(data.id ?? ''),\r\n        username: data.username ?? payload.username,\r\n        name: data.username ?? payload.username,\r\n        email: data.email ?? payload.email,\r\n        role: mappedRole,\r\n        permissions: ROLE_PERMISSIONS[mappedRole]\r\n      };\r\n\r\n      // 这里不进行自动登录，也不保存 token；注册后通常需要用户主动登录\r\n      return { success: true, message: 'Registration successful! Please sign in.', user };\r\n    } catch (error: any) {\r\n      let detailedMessage = 'Registration failed. Please try again later.';\r\n\r\n      if (error?.response) {\r\n        const status: number = error.response.status;\r\n        const data = error.response.data;\r\n        const serverMsg = typeof data === 'string'\r\n          ? data\r\n          : (data?.message || data?.error || data?.detail || '');\r\n\r\n        if (status === 400) {\r\n          detailedMessage = serverMsg || 'Invalid input. Please check your username, email, and password.';\r\n        // } else if (status === 409) {\r\n        //   detailedMessage = serverMsg || 'User already exists. Try a different username or email.';\r\n        // } else if (status >= 500) {\r\n        //   detailedMessage = serverMsg || 'Server error. Please try again later.';\r\n        // } \r\n        }else {\r\n          detailedMessage = serverMsg || `Request failed with status ${status}.`;\r\n        }\r\n      } else if (error?.request) {\r\n        detailedMessage = 'Unable to reach the server. Please ensure the backend is running on the correct URL.';\r\n      } else if (error?.message) {\r\n        detailedMessage = error.message;\r\n      }\r\n\r\n      return { success: false, message: detailedMessage };\r\n    }\r\n  }\r\n\r\n  // Logout\r\n  static logout(): void {\r\n    this.removeToken();\r\n    // Redirect to login page\r\n    if (typeof window !== 'undefined') {\r\n      window.location.href = '/auth/login';\r\n    }\r\n  }\r\n\r\n  // Generate mock JWT token\r\n  private static generateMockToken(role: string): string {\r\n    const header = btoa(JSON.stringify({ alg: 'HS256', typ: 'JWT' }));\r\n    const payload = btoa(JSON.stringify({\r\n      sub: role === 'admin' ? '1' : '2',\r\n      name: role === 'admin' ? 'Administrator' : 'System Operator',\r\n      role: role,\r\n      iat: Math.floor(Date.now() / 1000),\r\n      exp: Math.floor(Date.now() / 1000) + (24 * 60 * 60) // 24 hours\r\n    }));\r\n    const signature = btoa('mock-signature');\r\n    \r\n    return `${header}.${payload}.${signature}`;\r\n  }\r\n}\r\n\r\n// Permission checking utilities\r\nexport class PermissionManager {\r\n  // Check if user has specific permission\r\n  static hasPermission(permission: string, user?: User | null): boolean {\r\n    if (!user) {\r\n      const currentUser = AuthManager.getUser();\r\n      if (!currentUser) return false;\r\n      user = currentUser;\r\n    }\r\n    \r\n    return user.permissions.includes(permission);\r\n  }\r\n\r\n  // Check if user has any of the specified permissions\r\n  static hasAnyPermission(permissions: string[], user?: User | null): boolean {\r\n    return permissions.some(permission => this.hasPermission(permission, user));\r\n  }\r\n\r\n  // Check if user has all specified permissions\r\n  static hasAllPermissions(permissions: string[], user?: User | null): boolean {\r\n    return permissions.every(permission => this.hasPermission(permission, user));\r\n  }\r\n\r\n  // Check if user has specific role\r\n  static hasRole(role: string, user?: User | null): boolean {\r\n    if (!user) {\r\n      const currentUser = AuthManager.getUser();\r\n      if (!currentUser) return false;\r\n      user = currentUser;\r\n    }\r\n    \r\n    return user.role === role;\r\n  }\r\n\r\n  // Check if user has minimum role level\r\n  static hasMinimumRole(minRole: 'viewer' | 'operator' | 'admin', user?: User | null): boolean {\r\n    if (!user) {\r\n      const currentUser = AuthManager.getUser();\r\n      if (!currentUser) return false;\r\n      user = currentUser;\r\n    }\r\n    \r\n    const roleHierarchy = { viewer: 1, operator: 2, admin: 3 };\r\n    const userLevel = roleHierarchy[user.role];\r\n    const minLevel = roleHierarchy[minRole];\r\n    \r\n    return userLevel >= minLevel;\r\n  }\r\n}\r\n\r\n// Route protection utilities\r\nexport const requireAuth = () => {\r\n  if (typeof window === 'undefined') return true;\r\n  \r\n  if (!AuthManager.isAuthenticated()) {\r\n    window.location.href = '/auth/login';\r\n    return false;\r\n  }\r\n  \r\n  return true;\r\n};\r\n\r\nexport const requirePermission = (permission: string) => {\r\n  if (!requireAuth()) return false;\r\n  \r\n  if (!PermissionManager.hasPermission(permission)) {\r\n    // Redirect to unauthorized page or show error\r\n    console.error(`Access denied: Missing permission '${permission}'`);\r\n    return false;\r\n  }\r\n  \r\n  return true;\r\n};\r\n\r\nexport const requireRole = (role: string) => {\r\n  if (!requireAuth()) return false;\r\n  \r\n  if (!PermissionManager.hasRole(role)) {\r\n    console.error(`Access denied: Required role '${role}'`);\r\n    return false;\r\n  }\r\n  \r\n  return true;\r\n};\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 475, "column": 0}, "map": {"version":3,"sources":["file:///D:/A_%E5%AD%A6%E4%B9%A0%E6%96%87%E4%BB%B6/5619/ELEC5619-03-Group-1/frontend/src/components/Authentication/LoginForm.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport { Form, Input, Button, Card, message, Checkbox, Divider } from 'antd';\r\nimport { UserOutlined, LockOutlined, EyeInvisibleOutlined, EyeTwoTone } from '@ant-design/icons';\r\nimport Link from 'next/link';\r\nimport { AuthManager } from '@/lib/auth';\r\n\r\ninterface LoginFormData {\r\n  username: string;\r\n  password: string;\r\n  remember: boolean;\r\n}\r\n\r\ninterface LoginFormProps {\r\n  onLogin?: (data: LoginFormData) => void;\r\n  loading?: boolean;\r\n}\r\n\r\nconst LoginForm: React.FC<LoginFormProps> = ({ onLogin, loading = false }) => {\r\n  const [form] = Form.useForm();\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  const handleSubmit = async (values: LoginFormData) => {\r\n    setIsLoading(true);\r\n    try {\r\n      const result = await AuthManager.login(values.username, values.password);\r\n      \r\n      if (result.success) {\r\n        message.success('Login successful!');\r\n        \r\n        if (onLogin) {\r\n          onLogin(values);\r\n        }\r\n        \r\n        // Redirect to main page\r\n        window.location.href = '/';\r\n      } else {\r\n        message.error(result.message);\r\n      }\r\n    } catch (error) {\r\n      message.error('Login failed. Please try again.');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div>\r\n\r\n        <Form\r\n          form={form}\r\n          name=\"login\"\r\n          onFinish={handleSubmit}\r\n          autoComplete=\"off\"\r\n          size=\"large\"\r\n        >\r\n          <Form.Item\r\n            name=\"username\"\r\n            rules={[\r\n              { required: true, message: 'Please input your username!' },\r\n              { min: 3, message: 'Username must be at least 3 characters!' }\r\n            ]}\r\n          >\r\n            <Input \r\n              prefix={<UserOutlined />} \r\n              placeholder=\"Username\" \r\n            />\r\n          </Form.Item>\r\n\r\n          <Form.Item\r\n            name=\"password\"\r\n            rules={[\r\n              { required: true, message: 'Please input your password!' },\r\n              { min: 6, message: 'Password must be at least 6 characters!' }\r\n            ]}\r\n          >\r\n            <Input.Password\r\n              prefix={<LockOutlined />}\r\n              placeholder=\"Password\"\r\n              iconRender={(visible) => (visible ? <EyeTwoTone /> : <EyeInvisibleOutlined />)}\r\n            />\r\n          </Form.Item>\r\n\r\n          <Form.Item>\r\n            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n              <Form.Item name=\"remember\" valuePropName=\"checked\" noStyle>\r\n                <Checkbox>Remember me</Checkbox>\r\n              </Form.Item>\r\n              <Link href=\"/auth/forgot-password\" style={{ color: '#1890ff' }}>\r\n                Forgot password?\r\n              </Link>\r\n            </div>\r\n          </Form.Item>\r\n\r\n          <Form.Item>\r\n            <Button \r\n              type=\"primary\" \r\n              htmlType=\"submit\" \r\n              loading={isLoading || loading}\r\n              style={{ width: '100%', height: '40px' }}\r\n            >\r\n              Sign In\r\n            </Button>\r\n          </Form.Item>\r\n\r\n          <Divider>Or</Divider>\r\n\r\n          <div style={{ textAlign: 'center' }}>\r\n            <span style={{ color: '#666' }}>Don't have an account? </span>\r\n            <Link href=\"/auth/register\" style={{ color: '#1890ff', fontWeight: 'medium' }}>\r\n              Sign up now\r\n            </Link>\r\n          </div>\r\n        </Form>\r\n\r\n        <div style={{ marginTop: '24px', textAlign: 'center', fontSize: '12px', color: '#999' }}>\r\n          <p>Demo Mode: Enter any username and password to login</p>\r\n        </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default LoginForm;"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AANA;;;;;;;AAmBA,MAAM,YAAsC,CAAC,EAAE,OAAO,EAAE,UAAU,KAAK,EAAE;IACvE,MAAM,CAAC,KAAK,GAAG,sLAAI,CAAC,OAAO;IAC3B,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAE3C,MAAM,eAAe,OAAO;QAC1B,aAAa;QACb,IAAI;YACF,MAAM,SAAS,MAAM,iIAAW,CAAC,KAAK,CAAC,OAAO,QAAQ,EAAE,OAAO,QAAQ;YAEvE,IAAI,OAAO,OAAO,EAAE;gBAClB,+LAAO,CAAC,OAAO,CAAC;gBAEhB,IAAI,SAAS;oBACX,QAAQ;gBACV;gBAEA,wBAAwB;gBACxB,OAAO,QAAQ,CAAC,IAAI,GAAG;YACzB,OAAO;gBACL,+LAAO,CAAC,KAAK,CAAC,OAAO,OAAO;YAC9B;QACF,EAAE,OAAO,OAAO;YACd,+LAAO,CAAC,KAAK,CAAC;QAChB,SAAU;YACR,aAAa;QACf;IACF;IAEA,qBACE,8OAAC;;0BAEG,8OAAC,sLAAI;gBACH,MAAM;gBACN,MAAK;gBACL,UAAU;gBACV,cAAa;gBACb,MAAK;;kCAEL,8OAAC,sLAAI,CAAC,IAAI;wBACR,MAAK;wBACL,OAAO;4BACL;gCAAE,UAAU;gCAAM,SAAS;4BAA8B;4BACzD;gCAAE,KAAK;gCAAG,SAAS;4BAA0C;yBAC9D;kCAED,cAAA,8OAAC,yLAAK;4BACJ,sBAAQ,8OAAC,kOAAY;;;;;4BACrB,aAAY;;;;;;;;;;;kCAIhB,8OAAC,sLAAI,CAAC,IAAI;wBACR,MAAK;wBACL,OAAO;4BACL;gCAAE,UAAU;gCAAM,SAAS;4BAA8B;4BACzD;gCAAE,KAAK;gCAAG,SAAS;4BAA0C;yBAC9D;kCAED,cAAA,8OAAC,yLAAK,CAAC,QAAQ;4BACb,sBAAQ,8OAAC,kOAAY;;;;;4BACrB,aAAY;4BACZ,YAAY,CAAC,UAAa,wBAAU,8OAAC,4NAAU;;;;2DAAM,8OAAC,0PAAoB;;;;;;;;;;;;;;;kCAI9E,8OAAC,sLAAI,CAAC,IAAI;kCACR,cAAA,8OAAC;4BAAI,OAAO;gCAAE,SAAS;gCAAQ,gBAAgB;gCAAiB,YAAY;4BAAS;;8CACnF,8OAAC,sLAAI,CAAC,IAAI;oCAAC,MAAK;oCAAW,eAAc;oCAAU,OAAO;8CACxD,cAAA,8OAAC,kMAAQ;kDAAC;;;;;;;;;;;8CAEZ,8OAAC,uKAAI;oCAAC,MAAK;oCAAwB,OAAO;wCAAE,OAAO;oCAAU;8CAAG;;;;;;;;;;;;;;;;;kCAMpE,8OAAC,sLAAI,CAAC,IAAI;kCACR,cAAA,8OAAC,4MAAM;4BACL,MAAK;4BACL,UAAS;4BACT,SAAS,aAAa;4BACtB,OAAO;gCAAE,OAAO;gCAAQ,QAAQ;4BAAO;sCACxC;;;;;;;;;;;kCAKH,8OAAC,+LAAO;kCAAC;;;;;;kCAET,8OAAC;wBAAI,OAAO;4BAAE,WAAW;wBAAS;;0CAChC,8OAAC;gCAAK,OAAO;oCAAE,OAAO;gCAAO;0CAAG;;;;;;0CAChC,8OAAC,uKAAI;gCAAC,MAAK;gCAAiB,OAAO;oCAAE,OAAO;oCAAW,YAAY;gCAAS;0CAAG;;;;;;;;;;;;;;;;;;0BAMnF,8OAAC;gBAAI,OAAO;oBAAE,WAAW;oBAAQ,WAAW;oBAAU,UAAU;oBAAQ,OAAO;gBAAO;0BACpF,cAAA,8OAAC;8BAAE;;;;;;;;;;;;;;;;;AAIb;uCAEe","debugId":null}},
    {"offset": {"line": 742, "column": 0}, "map": {"version":3,"sources":["file:///D:/A_%E5%AD%A6%E4%B9%A0%E6%96%87%E4%BB%B6/5619/ELEC5619-03-Group-1/frontend/src/app/auth/login/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { Card, Row, Col } from 'antd';\r\nimport { AuthManager } from '@/lib/auth';\r\nimport LoginForm from '@/components/Authentication/LoginForm';\r\n\r\nconst LoginPage: React.FC = () => {\r\n  const router = useRouter();\r\n\r\n  useEffect(() => {\r\n    // Redirect if already authenticated\r\n    if (AuthManager.isAuthenticated()) {\r\n      router.push('/');\r\n    }\r\n  }, [router]);\r\n\r\n  return (\r\n    <div style={{\r\n      minHeight: '100vh',\r\n      background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n      justifyContent: 'center',\r\n      padding: '20px'\r\n    }}>\r\n      <Row justify=\"center\" style={{ width: '100%' }}>\r\n        <Col xs={20} sm={16} md={12} lg={8} xl={6}>\r\n          <Card\r\n            style={{\r\n              boxShadow: '0 8px 32px rgba(0, 0, 0, 0.1)',\r\n              borderRadius: '12px',\r\n              border: 'none'\r\n            }}\r\n            styles={{ body: { padding: '32px' } }}\r\n          >\r\n            <div style={{ textAlign: 'center', marginBottom: '30px' }}>\r\n              <h1 style={{ \r\n                fontSize: '28px', \r\n                fontWeight: 'bold', \r\n                color: '#1f2937',\r\n                marginBottom: '8px'\r\n              }}>\r\n                Host Management System\r\n              </h1>\r\n              <p style={{ \r\n                color: '#6b7280', \r\n                fontSize: '16px',\r\n                margin: 0\r\n              }}>\r\n                Sign in to your account\r\n              </p>\r\n            </div>\r\n            \r\n            <LoginForm />\r\n          </Card>\r\n        </Col>\r\n      </Row>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default LoginPage;"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAAA;AAAA;AACA;AACA;AANA;;;;;;;AAQA,MAAM,YAAsB;IAC1B,MAAM,SAAS,IAAA,+IAAS;IAExB,IAAA,kNAAS,EAAC;QACR,oCAAoC;QACpC,IAAI,iIAAW,CAAC,eAAe,IAAI;YACjC,OAAO,IAAI,CAAC;QACd;IACF,GAAG;QAAC;KAAO;IAEX,qBACE,8OAAC;QAAI,OAAO;YACV,WAAW;YACX,YAAY;YACZ,SAAS;YACT,YAAY;YACZ,gBAAgB;YAChB,SAAS;QACX;kBACE,cAAA,8OAAC,mLAAG;YAAC,SAAQ;YAAS,OAAO;gBAAE,OAAO;YAAO;sBAC3C,cAAA,8OAAC,mLAAG;gBAAC,IAAI;gBAAI,IAAI;gBAAI,IAAI;gBAAI,IAAI;gBAAG,IAAI;0BACtC,cAAA,8OAAC,sLAAI;oBACH,OAAO;wBACL,WAAW;wBACX,cAAc;wBACd,QAAQ;oBACV;oBACA,QAAQ;wBAAE,MAAM;4BAAE,SAAS;wBAAO;oBAAE;;sCAEpC,8OAAC;4BAAI,OAAO;gCAAE,WAAW;gCAAU,cAAc;4BAAO;;8CACtD,8OAAC;oCAAG,OAAO;wCACT,UAAU;wCACV,YAAY;wCACZ,OAAO;wCACP,cAAc;oCAChB;8CAAG;;;;;;8CAGH,8OAAC;oCAAE,OAAO;wCACR,OAAO;wCACP,UAAU;wCACV,QAAQ;oCACV;8CAAG;;;;;;;;;;;;sCAKL,8OAAC,4JAAS;;;;;;;;;;;;;;;;;;;;;;;;;;AAMtB;uCAEe","debugId":null}}]
}