{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/a99/localDocuments/codeBase/ideaWorkplace/reacttest/frontend/src/lib/auth.ts"],"sourcesContent":["// Authentication utilities for JWT token management and permission verification\nimport axios from 'axios';\n\n// API base URL used for frontend-to-backend requests.\n// Prefer reading from environment variable NEXT_PUBLIC_API_BASE_URL so you can easily switch between dev/staging/prod.\n// Fallback to Spring Boot's common default port (8080) when not provided.\n//设置默认请求地址为localhost:8080/api\nconst API_BASE_URL = (typeof process !== 'undefined' && process.env.NEXT_PUBLIC_API_BASE_URL)\n  ? `${process.env.NEXT_PUBLIC_API_BASE_URL}/api`\n  : 'http://localhost:8080/api';\n\nexport interface User {\n  id: string;\n  username: string;\n  name: string;\n  email: string;\n  role: 'admin' | 'operator' | 'viewer';\n  department?: string;\n  permissions: string[];\n  avatar?: string;\n}\n\nexport interface AuthState {\n  isAuthenticated: boolean;\n  user: User | null;\n  token: string | null;\n}\n\n// Role-based permissions mapping\nexport const ROLE_PERMISSIONS = {\n  admin: [\n    'user:read', 'user:write', 'user:delete',\n    'device:read', 'device:write', 'device:delete',\n    'project:read', 'project:write', 'project:delete',\n    'service:read', 'service:write', 'service:delete',\n    'monitoring:read', 'monitoring:write',\n    'alert:read', 'alert:write', 'alert:delete',\n    'system:read', 'system:write'\n  ],\n  operator: [\n    'user:read',\n    'device:read', 'device:write',\n    'project:read', 'project:write',\n    'service:read', 'service:write',\n    'monitoring:read',\n    'alert:read', 'alert:write'\n  ],\n  viewer: [\n    'user:read',\n    'device:read',\n    'project:read',\n    'service:read',\n    'monitoring:read',\n    'alert:read'\n  ]\n};\n\n// Token management\nexport class AuthManager {\n  private static readonly TOKEN_KEY = 'auth_token';\n  private static readonly USER_KEY = 'auth_user';\n  private static readonly REFRESH_TOKEN_KEY = 'refresh_token';\n\n  // Get stored token\n  static getToken(): string | null {\n    if (typeof window === 'undefined') return null;\n    return localStorage.getItem(this.TOKEN_KEY);\n  }\n\n  // Set token\n  static setToken(token: string): void {\n    if (typeof window === 'undefined') return;\n    localStorage.setItem(this.TOKEN_KEY, token);\n  }\n\n  // Remove token\n  static removeToken(): void {\n    if (typeof window === 'undefined') return;\n    localStorage.removeItem(this.TOKEN_KEY);\n    localStorage.removeItem(this.USER_KEY);\n    localStorage.removeItem(this.REFRESH_TOKEN_KEY);\n  }\n\n  // Get stored user\n  static getUser(): User | null {\n    if (typeof window === 'undefined') return null;\n    const userStr = localStorage.getItem(this.USER_KEY);\n    if (!userStr) return null;\n    \n    try {\n      const user = JSON.parse(userStr);\n      // Add permissions based on role\n      user.permissions = ROLE_PERMISSIONS[user.role as keyof typeof ROLE_PERMISSIONS] || [];\n      return user;\n    } catch {\n      return null;\n    }\n  }\n\n  // Set user\n  static setUser(user: User): void {\n    if (typeof window === 'undefined') return;\n    localStorage.setItem(this.USER_KEY, JSON.stringify(user));\n  }\n\n  // Check if token is expired\n  /**\n   * Check if a JWT token is expired.\n   * This version is defensive: if the token is not a valid JWT (e.g., a mock token without three parts),\n   * it will assume the token is NOT expired to avoid accidental logout in demo mode.\n   *\n   * Why: Our backend's mock /signin returns \"mock-jwt-token\" for testing, which is not a real JWT,\n   * and the previous implementation would treat it as expired immediately.\n   */\n  static isTokenExpired(token: string): boolean {\n    try {\n      const parts = token.split('.');\n      // If token is not in JWT format (header.payload.signature), treat it as not expired\n      if (parts.length !== 3) {\n        return false;\n      }\n      const payload = JSON.parse(atob(parts[1]));\n      const currentTime = Date.now() / 1000;\n      // If payload.exp exists and is a number, compare with current time; otherwise assume not expired\n      return typeof payload.exp === 'number' ? payload.exp < currentTime : false;\n    } catch {\n      // On any parsing error, assume not expired to keep user logged in\n      return false;\n    }\n  }\n\n  // Check if user is authenticated\n  static isAuthenticated(): boolean {\n    const token = this.getToken();\n    if (!token) return false;\n    \n    if (this.isTokenExpired(token)) {\n      this.removeToken();\n      return false;\n    }\n    \n    return true;\n  }\n\n  // Get current auth state\n  static getAuthState(): AuthState {\n    const token = this.getToken();\n    const user = this.getUser();\n    const isAuthenticated = this.isAuthenticated();\n    \n    return {\n      isAuthenticated,\n      user: isAuthenticated ? user : null,\n      token: isAuthenticated ? token : null\n    };\n  }\n\n  // Login\n  /**\n   * Perform login by calling backend API and storing JWT + user info locally.\n   *\n   * Flow:\n   * 1) Try POST `${API_BASE_URL}/auth/signin` with { username, password }.\n   *    - Expected response (JwtResponseDto): { token, type, id, username, email, roles }\n   *    - Save token to localStorage; map backend roles (e.g., ROLE_ADMIN/ROLE_OPERATOR/ROLE_USER)\n   *      to our app roles ('admin' | 'operator' | 'viewer') and assign permissions.\n   * 2) If /auth/signin fails (e.g., backend not ready), fall back to POST `${API_BASE_URL}/auth/login`.\n   *    - This endpoint returns a simple success flag. We'll store a mock token and basic user info so\n   *      the rest of the app can run for demo/testing.\n   *\n   * Returns: { success, message, user? }\n   */\n  static async login(username: string, password: string): Promise<{ success: boolean; message: string; user?: User }> {\n    try {\n      // Attempt real signin endpoint first\n      //使用axios发送POST请求 \n      const res = await axios.post(`${API_BASE_URL}/auth/signin`, {\n        username,\n        password\n      }, {\n        headers: { 'Content-Type': 'application/json' }\n      });\n\n      const data: any = res.data || {};\n      const token: string | undefined = data.token;\n\n      // 2.1) 如果后端没有返回 token，视为失败并给出清晰的提示（这在联调早期很常见）\n      if (!token) {\n        return { success: false, message: 'Login failed: token is missing in server response.' };\n      }\n\n      // 2.2) 角色数组（如 [\"ROLE_USER\", \"ROLE_ADMIN\"]），用于前端权限映射\n      const roles: string[] = Array.isArray(data.roles) ? data.roles : [];\n\n      // Map backend roles to frontend roles used in our app\n      const mappedRole: 'admin' | 'operator' | 'viewer' =\n        roles.includes('ROLE_ADMIN') ? 'admin' :\n        roles.includes('ROLE_OPERATOR') ? 'operator' :\n        'viewer';\n\n      const user: User = {\n        id: String(data.id ?? '1'),\n        username: data.username ?? username,\n        name: data.username ?? username,\n        email: data.email ?? `${username}@example.com`,\n        role: mappedRole,\n        permissions: ROLE_PERMISSIONS[mappedRole]\n      };\n\n      // Persist token and user\n      this.setToken(token);\n      this.setUser(user);\n\n      return { success: true, message: 'Login successful', user };\n    } catch (error: any) {\n      // 捕获失败并尽可能提取后端返回的详细错误信息\n      // error.response：后端有响应（例如 400/401/500 等）\n      // error.request：请求发出但未收到响应（网络/跨域/后端未启动）\n      // error.message：Axios/JS 层面的错误消息\n      let detailedMessage = 'Login failed. Please check your credentials or server status.';\n\n      if (error?.response) {\n        const status: number = error.response.status;\n        const data = error.response.data;\n\n        // 尝试从后端响应体中提取错误信息字段\n        const serverMsg = typeof data === 'string'\n          ? data\n          : (data?.message || data?.error || data?.detail || '');\n\n        if (status === 401) {\n          detailedMessage = serverMsg || 'Invalid username or password.';\n        } else if (status === 400) {\n          detailedMessage = serverMsg || 'Bad request. Please verify the input format.';\n        } else if (status >= 500) {\n          detailedMessage = serverMsg || 'Server error. Please try again later.';\n        } else {\n          detailedMessage = serverMsg || `Request failed with status ${status}.`;\n        }\n      } else if (error?.request) {\n        // 请求已发出但没有收到响应（大多是网络问题或后端未启动/地址不对）\n        detailedMessage = 'Unable to reach the server. Please confirm the backend is running and NEXT_PUBLIC_API_BASE_URL is correct.';\n      } else if (error?.message) {\n        // 其他 Axios/JS 层面错误\n        detailedMessage = error.message;\n      }\n\n      return { success: false, message: detailedMessage };\n    }\n  }\n\n  /**\n   * Register a new user by calling the backend signup API.\n   *\n   * What it does:\n   * - Sends a POST request to `${API_BASE_URL}/auth/signup` with { username, email, password }.\n   * - Expects the backend to return a `UserResponseDto` (id, username, email, roles, ...).\n   * - Maps backend roles (e.g., ROLE_ADMIN/ROLE_OPERATOR/ROLE_USER) to our app roles\n   *   ('admin' | 'operator' | 'viewer'), and prepares a `User` object for UI feedback.\n   * - Does NOT log the user in automatically; the caller should redirect to the login page.\n   *\n   * Error handling:\n   * - Provides detailed error messages based on HTTP status codes and server response body.\n   * - Common cases: 400 (validation), 409 (conflict), 500 (server errors).\n   *\n   * Returns: { success, message, user? }\n   */\n  static async register(payload: { username: string; email: string; password: string; roles?: string[] }): Promise<{ success: boolean; message: string; user?: User }> {\n    try {\n      const res = await axios.post(`${API_BASE_URL}/auth/signup`, payload, {\n        headers: { 'Content-Type': 'application/json' }\n      });\n\n      const data: any = res.data || {};\n      const rolesFromServer: string[] = Array.isArray(data.roles) ? data.roles : [];\n\n      const mappedRole: 'admin' | 'operator' | 'viewer' =\n        rolesFromServer.includes('ROLE_ADMIN') ? 'admin' :\n        rolesFromServer.includes('ROLE_OPERATOR') ? 'operator' :\n        'viewer';\n\n      const user: User = {\n        id: String(data.id ?? ''),\n        username: data.username ?? payload.username,\n        name: data.username ?? payload.username,\n        email: data.email ?? payload.email,\n        role: mappedRole,\n        permissions: ROLE_PERMISSIONS[mappedRole]\n      };\n\n      // 这里不进行自动登录，也不保存 token；注册后通常需要用户主动登录\n      return { success: true, message: 'Registration successful! Please sign in.', user };\n    } catch (error: any) {\n      let detailedMessage = 'Registration failed. Please try again later.';\n\n      if (error?.response) {\n        const status: number = error.response.status;\n        const data = error.response.data;\n        const serverMsg = typeof data === 'string'\n          ? data\n          : (data?.message || data?.error || data?.detail || '');\n\n        if (status === 400) {\n          detailedMessage = serverMsg || 'Invalid input. Please check your username, email, and password.';\n        // } else if (status === 409) {\n        //   detailedMessage = serverMsg || 'User already exists. Try a different username or email.';\n        // } else if (status >= 500) {\n        //   detailedMessage = serverMsg || 'Server error. Please try again later.';\n        // } \n        }else {\n          detailedMessage = serverMsg || `Request failed with status ${status}.`;\n        }\n      } else if (error?.request) {\n        detailedMessage = 'Unable to reach the server. Please ensure the backend is running on the correct URL.';\n      } else if (error?.message) {\n        detailedMessage = error.message;\n      }\n\n      return { success: false, message: detailedMessage };\n    }\n  }\n\n  // Logout\n  static logout(): void {\n    this.removeToken();\n    // Redirect to login page\n    if (typeof window !== 'undefined') {\n      window.location.href = '/auth/login';\n    }\n  }\n\n  // Generate mock JWT token\n  private static generateMockToken(role: string): string {\n    const header = btoa(JSON.stringify({ alg: 'HS256', typ: 'JWT' }));\n    const payload = btoa(JSON.stringify({\n      sub: role === 'admin' ? '1' : '2',\n      name: role === 'admin' ? 'Administrator' : 'System Operator',\n      role: role,\n      iat: Math.floor(Date.now() / 1000),\n      exp: Math.floor(Date.now() / 1000) + (24 * 60 * 60) // 24 hours\n    }));\n    const signature = btoa('mock-signature');\n    \n    return `${header}.${payload}.${signature}`;\n  }\n}\n\n// Permission checking utilities\nexport class PermissionManager {\n  // Check if user has specific permission\n  static hasPermission(permission: string, user?: User | null): boolean {\n    if (!user) {\n      const currentUser = AuthManager.getUser();\n      if (!currentUser) return false;\n      user = currentUser;\n    }\n    \n    return user.permissions.includes(permission);\n  }\n\n  // Check if user has any of the specified permissions\n  static hasAnyPermission(permissions: string[], user?: User | null): boolean {\n    return permissions.some(permission => this.hasPermission(permission, user));\n  }\n\n  // Check if user has all specified permissions\n  static hasAllPermissions(permissions: string[], user?: User | null): boolean {\n    return permissions.every(permission => this.hasPermission(permission, user));\n  }\n\n  // Check if user has specific role\n  static hasRole(role: string, user?: User | null): boolean {\n    if (!user) {\n      const currentUser = AuthManager.getUser();\n      if (!currentUser) return false;\n      user = currentUser;\n    }\n    \n    return user.role === role;\n  }\n\n  // Check if user has minimum role level\n  static hasMinimumRole(minRole: 'viewer' | 'operator' | 'admin', user?: User | null): boolean {\n    if (!user) {\n      const currentUser = AuthManager.getUser();\n      if (!currentUser) return false;\n      user = currentUser;\n    }\n    \n    const roleHierarchy = { viewer: 1, operator: 2, admin: 3 };\n    const userLevel = roleHierarchy[user.role];\n    const minLevel = roleHierarchy[minRole];\n    \n    return userLevel >= minLevel;\n  }\n}\n\n// Route protection utilities\nexport const requireAuth = () => {\n  if (typeof window === 'undefined') return true;\n  \n  if (!AuthManager.isAuthenticated()) {\n    window.location.href = '/auth/login';\n    return false;\n  }\n  \n  return true;\n};\n\nexport const requirePermission = (permission: string) => {\n  if (!requireAuth()) return false;\n  \n  if (!PermissionManager.hasPermission(permission)) {\n    // Redirect to unauthorized page or show error\n    console.error(`Access denied: Missing permission '${permission}'`);\n    return false;\n  }\n  \n  return true;\n};\n\nexport const requireRole = (role: string) => {\n  if (!requireAuth()) return false;\n  \n  if (!PermissionManager.hasRole(role)) {\n    console.error(`Access denied: Required role '${role}'`);\n    return false;\n  }\n  \n  return true;\n};\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 420, "column": 0}, "map": {"version":3,"sources":["file:///Users/a99/localDocuments/codeBase/ideaWorkplace/reacttest/frontend/src/components/Authentication/RegisterForm.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState } from 'react';\nimport { Form, Input, Button, Card, Modal, Divider, message } from 'antd';\nimport { UserOutlined, LockOutlined, MailOutlined, EyeInvisibleOutlined, EyeTwoTone } from '@ant-design/icons';\nimport Link from 'next/link';\nimport { AuthManager } from '@/lib/auth';\n\ninterface RegisterFormData {\n  username: string;\n  email: string;\n  password: string;\n}\n\ninterface RegisterFormProps {\n  onRegister?: (data: RegisterFormData) => void;\n  loading?: boolean;\n}\n\nconst RegisterForm: React.FC<RegisterFormProps> = ({ onRegister, loading = false }) => {\n  const [form] = Form.useForm();\n  const [isLoading, setIsLoading] = useState(false);\n  // 使用 antd v5 的 useMessage，在组件树中提供上下文，确保提示在所有环境下可见\n  const [messageApi, contextHolder] = message.useMessage();\n\n  /**\n   * 处理注册提交逻辑（成功时不弹窗）：\n   * - 成功：使用 antd 的 message 成功提示，然后自动跳转到登录页面（延时 1.2s，便于用户看到提示）\n   * - 失败：保留 Modal.error 弹窗，清晰展示错误信息\n   */\n  const handleSubmit = async (values: RegisterFormData) => {\n    setIsLoading(true);\n    try {\n      // 准备后端需要的精简字段：username、email、password（后端会设置默认角色）\n      const payload = {\n        username: values.username,\n        email: values.email,\n        password: values.password,\n      };\n  \n      // 调用统一的认证管理器，发起后端注册请求\n      const result = await AuthManager.register(payload);\n  \n      if (result.success) {\n        console.log(\"success!!register\");\n        // 如果父组件传入了 onRegister（例如用于埋点或额外处理），在此安全调用\n        if (onRegister) {\n          try {\n            onRegister(values);\n          } catch (e) {\n            console.error('onRegister callback error:', e);\n          }\n        }\n        // 成功后仅使用轻提示，然后自动跳转到登录页\n        messageApi.success(result.message || 'Registration successful! Please sign in.');\n        setTimeout(() => {\n          window.location.href = '/auth/login';\n        }, 2000);\n      } else {\n        // 使用 Modal 弹窗展示后端返回的错误信息，帮助用户理解失败原因\n        Modal.error({\n          title: 'Registration Failed',\n          content: result.message || 'Registration failed. Please try again.',\n          okText: 'OK',\n        });\n      }\n    } catch (error) {\n      // 兜底的异常捕获，使用弹窗避免错误信息被忽略\n      Modal.error({\n        title: 'Registration Failed',\n        content: 'Registration failed. Please try again.',\n        okText: 'OK',\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const validatePassword = (_: any, value: string) => {\n    if (!value) {\n      return Promise.reject(new Error('Please input your password!'));\n    }\n    if (value.length < 8) {\n      return Promise.reject(new Error('Password must be at least 8 characters!'));\n    }\n    if (!/(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)/.test(value)) {\n      return Promise.reject(new Error('Password must contain uppercase, lowercase and number!'));\n    }\n    return Promise.resolve();\n  };\n\n  return (\n    <div style={{ \n      minHeight: '100vh', \n      display: 'flex', \n      alignItems: 'center', \n      justifyContent: 'center',\n      background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',\n      padding: '20px'\n    }}>\n      {contextHolder}\n      <Card \n        style={{ \n          width: 500, \n          boxShadow: '0 4px 12px rgba(0,0,0,0.15)',\n          borderRadius: '8px'\n        }}\n        // Ant Design v5+: `bodyStyle` is deprecated. Use the new `styles.body` API instead to style the Card body.\n        styles={{ body: { padding: '32px' } }}\n        // Ant Design v5+: `bordered` 已弃用，使用新的 `variant` 属性\n        // `variant=\"borderless\"` 等价于旧的 bordered={false}\n        variant=\"borderless\"\n      >\n        <div style={{ textAlign: 'center', marginBottom: '24px' }}>\n          <h1 style={{ \n            fontSize: '24px', \n            fontWeight: 'bold', \n            color: '#1890ff',\n            margin: 0\n          }}>\n            Create Account\n          </h1>\n          <p style={{ color: '#666', marginTop: '8px' }}>Join the Host Management System</p>\n        </div>\n\n        <Form\n          form={form}\n          name=\"register\"\n          onFinish={handleSubmit}\n          autoComplete=\"off\"\n          size=\"large\"\n          layout=\"vertical\"\n        >\n          <Form.Item\n            label=\"Username\"\n            name=\"username\"\n            rules={[\n              { required: true, message: 'Please input your username!' },\n              { min: 3, message: 'Username must be at least 3 characters!' },\n              { pattern: /^[a-zA-Z0-9_]+$/, message: 'Username can only contain letters, numbers and underscore!' }\n            ]}\n          >\n            <Input \n              prefix={<UserOutlined />} \n              placeholder=\"Choose a username\" \n            />\n          </Form.Item>\n\n          <Form.Item\n            label=\"Email\"\n            name=\"email\"\n            rules={[\n              { required: true, message: 'Please input your email!' },\n              { type: 'email', message: 'Please enter a valid email address!' }\n            ]}\n          >\n            <Input \n              prefix={<MailOutlined />} \n              placeholder=\"Enter your email address\" \n            />\n          </Form.Item>\n\n          <Form.Item\n            label=\"Password\"\n            name=\"password\"\n            rules={[{ validator: validatePassword }]}\n          >\n            <Input.Password\n              prefix={<LockOutlined />}\n              placeholder=\"Create a strong password\"\n              iconRender={(visible) => (visible ? <EyeTwoTone /> : <EyeInvisibleOutlined />)}\n            />\n          </Form.Item>\n\n          <Form.Item>\n            <Button \n              type=\"primary\" \n              htmlType=\"submit\" \n              loading={isLoading || loading}\n              style={{ width: '100%', height: '40px' }}\n            >\n              Create Account\n            </Button>\n          </Form.Item>\n\n          <Divider>Or</Divider>\n\n          <div style={{ textAlign: 'center' }}>\n            <span style={{ color: '#666' }}>Already have an account? </span>\n            <Link href=\"/auth/login\" style={{ color: '#1890ff', fontWeight: 'medium' }}>\n              Sign in here\n            </Link>\n          </div>\n        </Form>\n\n        <div style={{ marginTop: '24px', padding: '12px', backgroundColor: '#f6f8fa', borderRadius: '4px' }}>\n          <p style={{ fontSize: '12px', color: '#666', margin: 0, textAlign: 'center' }}>\n            <strong>Note:</strong> Your account will be reviewed by an administrator before activation.\n          </p>\n        </div>\n      </Card>\n    </div>\n  );\n};\n\nexport default RegisterForm;"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 815, "column": 0}, "map": {"version":3,"sources":["file:///Users/a99/localDocuments/codeBase/ideaWorkplace/reacttest/frontend/src/app/auth/register/page.tsx"],"sourcesContent":["'use client';\n\nimport React, { useEffect } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { AuthManager } from '@/lib/auth';\nimport RegisterForm from '@/components/Authentication/RegisterForm';\n\nconst RegisterPage: React.FC = () => {\n  const router = useRouter();\n\n  useEffect(() => {\n    // Redirect if already authenticated\n    if (AuthManager.isAuthenticated()) {\n      router.push('/');\n    }\n  }, [router]);\n\n  return <RegisterForm />;\n};\n\nexport default RegisterPage;"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;;;AALA;;;;;AAOA,MAAM,eAAyB;;IAC7B,MAAM,SAAS,IAAA,kJAAS;IAExB,IAAA,0KAAS;kCAAC;YACR,oCAAoC;YACpC,IAAI,oIAAW,CAAC,eAAe,IAAI;gBACjC,OAAO,IAAI,CAAC;YACd;QACF;iCAAG;QAAC;KAAO;IAEX,qBAAO,6LAAC,kKAAY;;;;;AACtB;GAXM;;QACW,kJAAS;;;KADpB;uCAaS","debugId":null}}]
}