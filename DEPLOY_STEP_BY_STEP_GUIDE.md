# è¶…è¯¦ç»†Agentéƒ¨ç½²æŒ‡å—ï¼ˆæ‰‹æŠŠæ‰‹æ•™ç¨‹ï¼‰

## ğŸ“š ç›®å½•

1. [éƒ¨ç½²å‰å‡†å¤‡](#éƒ¨ç½²å‰å‡†å¤‡)
2. [åœ¨ä½ çš„ç”µè„‘ä¸Šæ“ä½œ](#åœ¨ä½ çš„ç”µè„‘ä¸Šæ“ä½œ)
3. [åœ¨ç›®æ ‡ç”µè„‘ä¸Šæ“ä½œ](#åœ¨ç›®æ ‡ç”µè„‘ä¸Šæ“ä½œ)
4. [éªŒè¯å’Œæµ‹è¯•](#éªŒè¯å’Œæµ‹è¯•)
5. [å¸¸è§é—®é¢˜è§£å†³](#å¸¸è§é—®é¢˜è§£å†³)

---

## ğŸ¯ éƒ¨ç½²å‰å‡†å¤‡

### ç†è§£æ•´ä¸ªç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å®Œæ•´ç›‘æ§ç³»ç»Ÿ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ä½ çš„ç”µè„‘(ç›‘æ§ä¸­å¿ƒ)              ç›®æ ‡ç”µè„‘(è¢«ç›‘æ§çš„æœåŠ¡å™¨)         â”‚
â”‚  IP: 192.168.1.100              IP: 192.168.1.200             â”‚
â”‚       â†“                              â†“                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ Spring Boot â”‚ â†â”€â”€æ¨é€æ•°æ®â”€â”€  â”‚  Python     â”‚               â”‚
â”‚  â”‚ åç«¯        â”‚   æ¯60ç§’       â”‚  Agent      â”‚               â”‚
â”‚  â”‚ ç«¯å£:8080   â”‚   HTTP POST    â”‚  é‡‡é›†æŒ‡æ ‡   â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚       â†“                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚  â”‚   MySQL     â”‚                                               â”‚
â”‚  â”‚   æ•°æ®åº“    â”‚                                               â”‚
â”‚  â”‚server_metricsâ”‚                                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚       â†“                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚  â”‚  Next.js    â”‚                                               â”‚
â”‚  â”‚  å‰ç«¯å±•ç¤º   â”‚                                               â”‚
â”‚  â”‚ ç«¯å£:3000   â”‚                                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµå‘

```
æ­¥éª¤1: Agenté‡‡é›†ç³»ç»ŸæŒ‡æ ‡
       â†“
æ­¥éª¤2: æ‰“åŒ…æˆJSONæ•°æ®
       {
         "serverId": 2,
         "cpuUsage": 25.5,
         "memoryUsage": 48.2,
         ...
       }
       â†“
æ­¥éª¤3: HTTP POSTæ¨é€åˆ°ä½ çš„ç”µè„‘
       POST http://192.168.1.100:8080/api/servers/metrics/collect
       â†“
æ­¥éª¤4: åç«¯æ¥æ”¶å¹¶ä¿å­˜åˆ°æ•°æ®åº“
       INSERT INTO server_metrics ...
       â†“
æ­¥éª¤5: å‰ç«¯æŸ¥è¯¢å¹¶å±•ç¤º
       SELECT * FROM server_metrics WHERE server_id = 2
```

### éœ€è¦å‡†å¤‡çš„ä¸œè¥¿

- [ ] ä½ çš„ç”µè„‘ï¼ˆç›‘æ§å¹³å°ï¼‰
  - Spring Bootåç«¯æ­£åœ¨è¿è¡Œ
  - çŸ¥é“è‡ªå·±çš„IPåœ°å€
  - é˜²ç«å¢™å·²é…ç½®
  
- [ ] ç›®æ ‡ç”µè„‘ï¼ˆè¢«ç›‘æ§ï¼‰
  - èƒ½è”ç½‘
  - èƒ½è®¿é—®ä½ çš„ç”µè„‘
  - ç¨åå®‰è£…Python

- [ ] ç½‘ç»œç¯å¢ƒ
  - ä¸¤å°ç”µè„‘åœ¨åŒä¸€å±€åŸŸç½‘
  - æˆ–ç›®æ ‡ç”µè„‘èƒ½é€šè¿‡äº’è”ç½‘è®¿é—®ä½ çš„ç”µè„‘

---

## ğŸ“ åœ¨ä½ çš„ç”µè„‘ä¸Šæ“ä½œ

### ğŸ”¹ æ­¥éª¤1ï¼šæŸ¥æ‰¾ä½ çš„IPåœ°å€

#### Windowsç³»ç»Ÿ

1. æŒ‰ `Win + R`
2. è¾“å…¥ `cmd`ï¼Œå›è½¦
3. è¾“å…¥å‘½ä»¤ï¼š
```cmd
ipconfig
```

4. æŸ¥æ‰¾è¾“å‡ºä¸­çš„ **IPv4 åœ°å€**ï¼š
```
ä»¥å¤ªç½‘é€‚é…å™¨ ä»¥å¤ªç½‘:
   IPv4 åœ°å€ . . . . . . . . . . . . : 192.168.1.100  <-- è¿™ä¸ªå°±æ˜¯ï¼
   å­ç½‘æ©ç   . . . . . . . . . . . . : 255.255.255.0
   é»˜è®¤ç½‘å…³. . . . . . . . . . . . . : 192.168.1.1
```

**è®°ä¸‹è¿™ä¸ªIPåœ°å€ï¼š`192.168.1.100`**

#### å¦‚æœçœ‹åˆ°å¤šä¸ªç½‘ç»œé€‚é…å™¨ï¼š

```
æ— çº¿å±€åŸŸç½‘é€‚é…å™¨ WLAN:
   IPv4 åœ°å€ . . . . . . . . . : 192.168.1.100  <-- å¦‚æœç”¨WiFiï¼Œç”¨è¿™ä¸ª

ä»¥å¤ªç½‘é€‚é…å™¨ ä»¥å¤ªç½‘:
   IPv4 åœ°å€ . . . . . . . . . : 192.168.2.50   <-- å¦‚æœç”¨ç½‘çº¿ï¼Œç”¨è¿™ä¸ª

ä»¥å¤ªç½‘é€‚é…å™¨ VMware Network Adapter VMnet8:
   IPv4 åœ°å€ . . . . . . . . . : 192.168.88.1   <-- è™šæ‹Ÿç½‘å¡ï¼Œå¿½ç•¥
```

**é€‰æ‹©è§„åˆ™ï¼š**
- å¦‚æœç”¨WiFiè¿æ¥ï¼šç”¨ **WLAN** çš„IP
- å¦‚æœç”¨ç½‘çº¿è¿æ¥ï¼šç”¨ **ä»¥å¤ªç½‘** çš„IP
- å¿½ç•¥è™šæ‹Ÿç½‘å¡ï¼ˆVMwareã€VirtualBoxç­‰ï¼‰

---

### ğŸ”¹ æ­¥éª¤2ï¼šå¼€æ”¾é˜²ç«å¢™ç«¯å£

#### æ–¹æ³•Aï¼šä½¿ç”¨PowerShellï¼ˆæ¨èï¼‰

1. å³é”®ç‚¹å‡»"å¼€å§‹"æŒ‰é’®
2. é€‰æ‹© **"Windows PowerShell (ç®¡ç†å‘˜)"** æˆ– **"ç»ˆç«¯ (ç®¡ç†å‘˜)"**
3. è¾“å…¥å‘½ä»¤ï¼š

```powershell
New-NetFirewallRule -DisplayName "ç›‘æ§å¹³å°-åç«¯8080ç«¯å£" `
    -Direction Inbound `
    -LocalPort 8080 `
    -Protocol TCP `
    -Action Allow
```

4. çœ‹åˆ°ç±»ä¼¼è¾“å‡ºè¡¨ç¤ºæˆåŠŸï¼š
```
Name                  : {éšæœºGUID}
DisplayName           : ç›‘æ§å¹³å°-åç«¯8080ç«¯å£
Description           :
...
```

#### æ–¹æ³•Bï¼šä½¿ç”¨å›¾å½¢ç•Œé¢

1. æŒ‰ `Win + R`ï¼Œè¾“å…¥ `wf.msc`ï¼Œå›è½¦
2. ç‚¹å‡»å·¦ä¾§ **"å…¥ç«™è§„åˆ™"**
3. ç‚¹å‡»å³ä¾§ **"æ–°å»ºè§„åˆ™..."**
4. é€‰æ‹© **"ç«¯å£"**ï¼Œä¸‹ä¸€æ­¥
5. é€‰æ‹© **TCP**ï¼Œç‰¹å®šæœ¬åœ°ç«¯å£ï¼š**8080**ï¼Œä¸‹ä¸€æ­¥
6. é€‰æ‹© **"å…è®¸è¿æ¥"**ï¼Œä¸‹ä¸€æ­¥
7. å…¨éƒ¨å‹¾é€‰ï¼ˆåŸŸã€ä¸“ç”¨ã€å…¬ç”¨ï¼‰ï¼Œä¸‹ä¸€æ­¥
8. åç§°ï¼š**ç›‘æ§å¹³å°åç«¯**ï¼Œå®Œæˆ

#### éªŒè¯é˜²ç«å¢™è§„åˆ™

```powershell
Get-NetFirewallRule -DisplayName "ç›‘æ§å¹³å°*" | Format-Table DisplayName, Enabled, Direction
```

åº”è¯¥çœ‹åˆ°ï¼š
```
DisplayName              Enabled Direction
-----------              ------- ---------
ç›‘æ§å¹³å°-åç«¯8080ç«¯å£      True    Inbound
```

---

### ğŸ”¹ æ­¥éª¤3ï¼šç¡®è®¤åç«¯æ­£åœ¨è¿è¡Œ

#### æ£€æŸ¥åç«¯çŠ¶æ€

```powershell
# æ£€æŸ¥8080ç«¯å£æ˜¯å¦åœ¨ç›‘å¬
netstat -ano | findstr :8080
```

åº”è¯¥çœ‹åˆ°ç±»ä¼¼ï¼š
```
TCP    0.0.0.0:8080           0.0.0.0:0              LISTENING       12345
TCP    [::]:8080              [::]:0                 LISTENING       12345
```

å¦‚æœæ²¡æœ‰è¾“å‡ºï¼Œè¯´æ˜åç«¯æ²¡è¿è¡Œï¼Œéœ€è¦å¯åŠ¨ï¼š

```powershell
cd D:\5619\ELEC5619-03-Group-1\backend
.\mvnw.cmd spring-boot:run
```

æˆ–åœ¨IDEä¸­è¿è¡Œ `BackendApplication`

#### æµ‹è¯•åç«¯API

```powershell
# æµ‹è¯•å¥åº·æ£€æŸ¥æ¥å£
curl http://localhost:8080/actuator/health

# æµ‹è¯•Agentæ¨é€æ¥å£
$testData = '{"serverId":1,"cpuUsage":10.0}'
Invoke-RestMethod -Uri "http://localhost:8080/api/servers/metrics/collect" `
    -Method Post -Body $testData -ContentType "application/json"
```

---

### ğŸ”¹ æ­¥éª¤4ï¼šåœ¨å¹³å°ä¸­åˆ›å»ºæœåŠ¡å™¨è®°å½•

è¿™ä¸€æ­¥**éå¸¸é‡è¦**ï¼å¿…é¡»å…ˆåˆ›å»ºæœåŠ¡å™¨è®°å½•ï¼Œæ‰èƒ½è·å¾— Server IDã€‚

#### æ–¹æ³•Aï¼šä½¿ç”¨Swagger UIï¼ˆæœ€ç®€å•ï¼‰

1. æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼š
```
http://localhost:8080/swagger-ui.html
```

2. æ‰¾åˆ° **"Authentication"** éƒ¨åˆ†ï¼Œå±•å¼€ **POST /api/auth/signin**

3. ç‚¹å‡» **"Try it out"**

4. åœ¨Request bodyä¸­è¾“å…¥ï¼š
```json
{
  "username": "admin",
  "password": "admin123"
}
```

5. ç‚¹å‡» **"Execute"**

6. å¤åˆ¶å“åº”ä¸­çš„ **token** å€¼ï¼ˆå¾ˆé•¿çš„ä¸€ä¸²å­—ç¬¦ï¼‰ï¼š
```json
{
  "token": "eyJhbGciOiJIUzI1NiJ9.eyJ1c2VySWQ...",  <-- å¤åˆ¶è¿™ä¸ª
  ...
}
```

7. ç‚¹å‡»é¡µé¢é¡¶éƒ¨çš„ **ğŸ”“ Authorize** æŒ‰é’®

8. ç²˜è´´tokenï¼ˆ**ä¸è¦åŠ ** "Bearer " å‰ç¼€ï¼‰ï¼Œç‚¹å‡» **"Authorize"**ï¼Œå†ç‚¹å‡» **"Close"**

9. æ‰¾åˆ° **"Server Management"** éƒ¨åˆ†ï¼Œå±•å¼€ **POST /api/servers**

10. ç‚¹å‡» **"Try it out"**

11. åœ¨Request bodyä¸­è¾“å…¥ç›®æ ‡ç”µè„‘çš„ä¿¡æ¯ï¼š
```json
{
  "serverName": "Remote-Computer-01",
  "ipAddress": "192.168.1.200",
  "operatingSystem": "Windows 11",
  "cpu": "Intel i5",
  "memory": "16GB",
  "status": "unknown"
}
```

**å­—æ®µè¯´æ˜ï¼š**
- `serverName`: ç»™ç›®æ ‡ç”µè„‘èµ·ä¸ªåå­—ï¼ˆå¿…å¡«ï¼‰
- `ipAddress`: ç›®æ ‡ç”µè„‘çš„IPï¼ˆå¿…å¡«ï¼Œå¯ä»¥éšä¾¿å¡«ï¼Œåé¢ä¼šæ›´æ–°ï¼‰
- `operatingSystem`: æ“ä½œç³»ç»Ÿï¼ˆé€‰å¡«ï¼‰
- `cpu`: CPUå‹å·ï¼ˆé€‰å¡«ï¼‰
- `memory`: å†…å­˜å¤§å°ï¼ˆé€‰å¡«ï¼‰
- `status`: çŠ¶æ€ï¼Œå¡« `unknown` å°±è¡Œ

12. ç‚¹å‡» **"Execute"**

13. æŸ¥çœ‹å“åº”ï¼Œ**è®°ä¸‹ id å€¼**ï¼š
```json
{
  "id": 2,  <-- è¿™ä¸ªå°±æ˜¯ Server IDï¼Œéå¸¸é‡è¦ï¼
  "serverName": "Remote-Computer-01",
  "ipAddress": "192.168.1.200",
  ...
}
```

**æŠŠ Server ID è®°åœ¨çº¸ä¸Šæˆ–è®°äº‹æœ¬ï¼š`Server ID = 2`**

#### æ–¹æ³•Bï¼šä½¿ç”¨PowerShell

```powershell
# 1. ç™»å½•è·å–token
$loginResponse = Invoke-RestMethod `
    -Uri "http://localhost:8080/api/auth/signin" `
    -Method Post `
    -ContentType "application/json" `
    -Body '{"username":"admin","password":"admin123"}'

$token = $loginResponse.token
Write-Host "Tokenè·å–æˆåŠŸ" -ForegroundColor Green

# 2. åˆ›å»ºæœåŠ¡å™¨
$serverData = @{
    serverName = "Remote-Computer-01"
    ipAddress = "192.168.1.200"
    operatingSystem = "Windows 11"
    status = "unknown"
} | ConvertTo-Json

$headers = @{
    "Authorization" = "Bearer $token"
    "Content-Type" = "application/json"
}

$newServer = Invoke-RestMethod `
    -Uri "http://localhost:8080/api/servers" `
    -Method Post `
    -Headers $headers `
    -Body $serverData

# 3. æ˜¾ç¤ºServer ID
Write-Host "`næœåŠ¡å™¨åˆ›å»ºæˆåŠŸï¼" -ForegroundColor Green
Write-Host "Server ID: $($newServer.id)" -ForegroundColor Yellow
Write-Host "Server Name: $($newServer.serverName)" -ForegroundColor White
Write-Host "`nè¯·è®°ä¸‹è¿™ä¸ª Server IDï¼Œé…ç½®Agentæ—¶éœ€è¦ç”¨åˆ°ï¼" -ForegroundColor Cyan
```

---

### ğŸ”¹ æ­¥éª¤5ï¼šåˆ›å»ºAgentéƒ¨ç½²åŒ…

ç°åœ¨æˆ‘ä»¬æŠŠæ‰€æœ‰éœ€è¦çš„æ–‡ä»¶æ‰“åŒ…ï¼Œæ–¹ä¾¿ä¼ è¾“åˆ°ç›®æ ‡ç”µè„‘ã€‚

#### è¿è¡Œéƒ¨ç½²åŒ…ç”Ÿæˆè„šæœ¬

```powershell
cd D:\5619\ELEC5619-03-Group-1
.\create_deployment_package.ps1
```

#### äº¤äº’å¼è¾“å…¥

è„šæœ¬ä¼šé—®ä½ å‡ ä¸ªé—®é¢˜ï¼š

**é—®é¢˜1: Platform IP**
```
Enter your platform server IP address:
(e.g., 192.168.1.100 or your public IP)
Platform IP: 
```
è¾“å…¥ä½ åœ¨æ­¥éª¤1ä¸­æ‰¾åˆ°çš„IPåœ°å€ï¼š`192.168.1.100`

**é—®é¢˜2: Server ID**
```
Enter the Server ID for the remote machine:
(Create this in your platform first!)
Server ID: 
```
è¾“å…¥æ­¥éª¤4ä¸­è·å¾—çš„Server IDï¼š`2`

#### æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶

è„šæœ¬ä¼šåˆ›å»º `agent-deployment-package` æ–‡ä»¶å¤¹ï¼š

```
agent-deployment-package/
â”œâ”€â”€ server_agent.py              # Agentä¸»ç¨‹åº
â”œâ”€â”€ agent_config.json            # é…ç½®æ–‡ä»¶ï¼ˆå·²è‡ªåŠ¨é…ç½®å¥½ï¼‰
â”œâ”€â”€ install_windows.bat          # Windowså®‰è£…è„šæœ¬
â”œâ”€â”€ install_linux.sh             # Linuxå®‰è£…è„šæœ¬
â”œâ”€â”€ start_agent_windows.bat      # Windowså¯åŠ¨è„šæœ¬
â”œâ”€â”€ start_agent_linux.sh         # Linuxå¯åŠ¨è„šæœ¬
â””â”€â”€ README.txt                   # ä½¿ç”¨è¯´æ˜
```

#### æ£€æŸ¥é…ç½®æ–‡ä»¶å†…å®¹

æ‰“å¼€ `agent-deployment-package/agent_config.json`ï¼Œç¡®è®¤å†…å®¹ï¼š

```json
{
  "platform_url": "http://192.168.1.100:8080/api/servers/metrics/collect",
  "server_id": 2,
  "interval": 60,
  "log_level": "INFO"
}
```

**é‡è¦æ£€æŸ¥ï¼š**
- âœ… `platform_url` ä¸­çš„IPæ˜¯ä½ çš„IPï¼ˆ**ä¸æ˜¯** localhostï¼‰
- âœ… `server_id` æ˜¯åˆšæ‰åˆ›å»ºçš„æœåŠ¡å™¨ID
- âœ… ç«¯å£æ˜¯ `8080`

---

### ğŸ”¹ æ­¥éª¤6ï¼šæµ‹è¯•ç½‘ç»œè¿é€šæ€§ï¼ˆé‡è¦ï¼ï¼‰

åœ¨ä¼ è¾“æ–‡ä»¶ä¹‹å‰ï¼Œå…ˆç¡®ä¿ç›®æ ‡ç”µè„‘èƒ½è®¿é—®ä½ çš„ç”µè„‘ã€‚

#### è·å–ç›®æ ‡ç”µè„‘çš„IP

**å¦‚æœç›®æ ‡ç”µè„‘åœ¨ä½ æ—è¾¹ï¼š**
1. åœ¨ç›®æ ‡ç”µè„‘ä¸ŠæŒ‰ `Win + R`
2. è¾“å…¥ `cmd`
3. è¾“å…¥ `ipconfig`
4. æ‰¾åˆ° IPv4 åœ°å€ï¼Œä¾‹å¦‚ï¼š`192.168.1.200`

**å¦‚æœé€šè¿‡è¿œç¨‹æ¡Œé¢ï¼š**
- è¿œç¨‹æ¡Œé¢è¿æ¥æ—¶ä¼šæ˜¾ç¤ºç›®æ ‡IP
- æˆ–åœ¨ç›®æ ‡æœºå™¨è¿è¡Œ `ipconfig`

#### ä»ç›®æ ‡ç”µè„‘æµ‹è¯•è¿æ¥

**å¦‚æœç›®æ ‡ç”µè„‘åœ¨ä½ æ—è¾¹ï¼š**

åœ¨ç›®æ ‡ç”µè„‘ä¸Šæ‰“å¼€PowerShellï¼Œè¿è¡Œï¼š

```powershell
# æµ‹è¯•ç½‘ç»œè¿é€šæ€§
ping 192.168.1.100

# æµ‹è¯•ç«¯å£è¿é€šæ€§
Test-NetConnection -ComputerName 192.168.1.100 -Port 8080

# æµ‹è¯•HTTPè®¿é—®
curl http://192.168.1.100:8080/actuator/health
```

**æœŸæœ›ç»“æœï¼š**

PingæˆåŠŸï¼š
```
æ­£åœ¨ Ping 192.168.1.100 å…·æœ‰ 32 å­—èŠ‚çš„æ•°æ®:
æ¥è‡ª 192.168.1.100 çš„å›å¤: å­—èŠ‚=32 æ—¶é—´<1ms TTL=128
```

ç«¯å£æµ‹è¯•æˆåŠŸï¼š
```
TcpTestSucceeded : True
```

HTTPæµ‹è¯•æˆåŠŸï¼ˆå¯èƒ½è¿”å›403ï¼Œä½†ä¸æ˜¯è¿æ¥é”™è¯¯å°±è¡Œï¼‰ï¼š
```
StatusCode        : 403
æˆ–
StatusCode        : 200
```

**å¦‚æœè¿æ¥å¤±è´¥ï¼š**
- æ£€æŸ¥ä¸¤å°ç”µè„‘æ˜¯å¦åœ¨åŒä¸€ç½‘ç»œ
- æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦å¼€æ”¾
- æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ

---

### ğŸ”¹ æ­¥éª¤7ï¼šä¼ è¾“éƒ¨ç½²åŒ…åˆ°ç›®æ ‡ç”µè„‘

#### æ–¹æ³•Aï¼šUç›˜ä¼ è¾“ï¼ˆæœ€ç®€å•ï¼‰

1. æ’å…¥Uç›˜
2. å¤åˆ¶ `agent-deployment-package` æ–‡ä»¶å¤¹åˆ°Uç›˜
3. åœ¨ç›®æ ‡ç”µè„‘ä¸Šï¼Œä»Uç›˜å¤åˆ¶åˆ°ï¼š
   - Windows: `C:\agent\`
   - Linux: `/opt/agent/`

#### æ–¹æ³•Bï¼šå±€åŸŸç½‘å…±äº«

**åœ¨ä½ çš„ç”µè„‘ä¸Šï¼š**

1. å³é”®ç‚¹å‡» `agent-deployment-package` æ–‡ä»¶å¤¹
2. é€‰æ‹©"å±æ€§" â†’ "å…±äº«"æ ‡ç­¾
3. ç‚¹å‡»"å…±äº«"ï¼Œæ·»åŠ  Everyoneï¼Œæƒé™è®¾ä¸º"è¯»å–"
4. è®°ä¸‹å…±äº«è·¯å¾„ï¼Œä¾‹å¦‚ï¼š`\\192.168.1.100\agent-deployment-package`

**åœ¨ç›®æ ‡ç”µè„‘ä¸Šï¼š**

1. æŒ‰ `Win + R`
2. è¾“å…¥ï¼š`\\192.168.1.100\agent-deployment-package`
3. å¤åˆ¶æ•´ä¸ªæ–‡ä»¶å¤¹åˆ° `C:\agent\`

#### æ–¹æ³•Cï¼šç½‘ç›˜ä¼ è¾“

1. å‹ç¼© `agent-deployment-package` æ–‡ä»¶å¤¹
```powershell
Compress-Archive -Path agent-deployment-package -DestinationPath agent-package.zip
```

2. ä¸Šä¼ åˆ°ç½‘ç›˜ï¼ˆç™¾åº¦ç½‘ç›˜ã€OneDriveç­‰ï¼‰

3. åœ¨ç›®æ ‡ç”µè„‘ä¸‹è½½å¹¶è§£å‹

---

## ğŸ–¥ï¸ åœ¨ç›®æ ‡ç”µè„‘ä¸Šæ“ä½œ

ç°åœ¨åˆ‡æ¢åˆ°ç›®æ ‡ç”µè„‘ï¼ˆè¢«ç›‘æ§çš„ç”µè„‘ï¼‰è¿›è¡Œæ“ä½œã€‚

### ğŸ”¹ æ­¥éª¤1ï¼šæ£€æŸ¥Pythonç¯å¢ƒ

#### æ£€æŸ¥æ˜¯å¦å·²å®‰è£…Python

æ‰“å¼€PowerShellæˆ–å‘½ä»¤æç¤ºç¬¦ï¼š

```cmd
python --version
```

**å¦‚æœçœ‹åˆ°ï¼š**
```
Python 3.13.2
```
è¯´æ˜å·²å®‰è£…ï¼Œè·³åˆ°æ­¥éª¤2ã€‚

**å¦‚æœçœ‹åˆ°ï¼š**
```
'python' ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤...
```
è¯´æ˜æœªå®‰è£…ï¼Œéœ€è¦å®‰è£…Pythonã€‚

#### å®‰è£…Pythonï¼ˆå¦‚æœéœ€è¦ï¼‰

**Windowsç³»ç»Ÿï¼š**

1. è®¿é—® https://www.python.org/downloads/
2. ä¸‹è½½æœ€æ–°ç‰ˆPython 3ï¼ˆä¾‹å¦‚Python 3.11ï¼‰
3. è¿è¡Œå®‰è£…ç¨‹åº
4. **é‡è¦ï¼š** å‹¾é€‰ **"Add Python to PATH"**
5. ç‚¹å‡» "Install Now"
6. å®‰è£…å®Œæˆåï¼Œé‡æ–°æ‰“å¼€å‘½ä»¤æç¤ºç¬¦ï¼Œè¿è¡Œ `python --version` éªŒè¯

**Linuxç³»ç»Ÿï¼š**

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install python3 python3-pip

# CentOS/RHEL
sudo yum install python3 python3-pip

# éªŒè¯
python3 --version
```

---

### ğŸ”¹ æ­¥éª¤2ï¼šè¿›å…¥éƒ¨ç½²ç›®å½•

æ‰“å¼€PowerShellæˆ–å‘½ä»¤æç¤ºç¬¦ï¼š

```cmd
cd C:\agent\agent-deployment-package
```

æˆ–

```cmd
cd /opt/agent/agent-deployment-package
```

æŸ¥çœ‹æ–‡ä»¶ï¼š

```cmd
dir
```

åº”è¯¥çœ‹åˆ°ï¼š
```
server_agent.py
agent_config.json
install_windows.bat
...
```

---

### ğŸ”¹ æ­¥éª¤3ï¼šå®‰è£…ä¾èµ–

#### Windowsç³»ç»Ÿ

**æ–¹æ³•Aï¼šä½¿ç”¨å®‰è£…è„šæœ¬ï¼ˆæ¨èï¼‰**

åŒå‡»è¿è¡Œ `install_windows.bat`

æˆ–åœ¨å‘½ä»¤æç¤ºç¬¦ä¸­ï¼š
```cmd
install_windows.bat
```

**æœŸæœ›è¾“å‡ºï¼š**
```
========================================
  Installing Server Monitoring Agent
========================================
Python found!
Installing dependencies...
Requirement already satisfied: psutil in ...
Requirement already satisfied: requests in ...

========================================
  Installation Complete!
========================================

Configuration:
{
  "platform_url": "http://192.168.1.100:8080/api/servers/metrics/collect",
  "server_id": 2,
  "interval": 60,
  "log_level": "INFO"
}

To start agent, run:
  python server_agent.py

è¯·æŒ‰ä»»æ„é”®ç»§ç»­. . .
```

**æ–¹æ³•Bï¼šæ‰‹åŠ¨å®‰è£…**

```cmd
pip install psutil requests
```

#### Linuxç³»ç»Ÿ

```bash
chmod +x install_linux.sh
./install_linux.sh
```

æˆ–æ‰‹åŠ¨ï¼š

```bash
pip3 install psutil requests
```

---

### ğŸ”¹ æ­¥éª¤4ï¼šéªŒè¯é…ç½®æ–‡ä»¶

åœ¨å¯åŠ¨Agentä¹‹å‰ï¼Œå†æ¬¡ç¡®è®¤é…ç½®ï¼š

```cmd
type agent_config.json
```

æˆ–

```bash
cat agent_config.json
```

**ç¡®è®¤ä»¥ä¸‹å†…å®¹ï¼š**
```json
{
  "platform_url": "http://192.168.1.100:8080/api/servers/metrics/collect",
  "server_id": 2,
  "interval": 60,
  "log_level": "INFO"
}
```

**æ£€æŸ¥æ¸…å•ï¼š**
- [ ] `platform_url` ä¸­çš„IPæ˜¯ç›‘æ§å¹³å°çš„IPï¼ˆ**ä¸æ˜¯** `localhost`ï¼‰
- [ ] `server_id` æ˜¯æ­£ç¡®çš„æœåŠ¡å™¨ID
- [ ] ç«¯å£æ˜¯ `8080`
- [ ] æ²¡æœ‰å¤šä½™çš„é€—å·æˆ–å¼•å·

**å¦‚æœéœ€è¦ä¿®æ”¹ï¼š**

Windows:
```cmd
notepad agent_config.json
```

Linux:
```bash
nano agent_config.json
# æˆ–
vim agent_config.json
```

---

### ğŸ”¹ æ­¥éª¤5ï¼šå¯åŠ¨Agent

#### æµ‹è¯•è¿è¡Œï¼ˆå‰å°ï¼‰

**Windows:**

```cmd
python server_agent.py
```

**Linux:**

```bash
python3 server_agent.py
```

#### æœŸæœ›è¾“å‡º

```
======================================================================
                 æœåŠ¡å™¨ç›‘æ§Agent
======================================================================
æœåŠ¡å™¨ID:        2
å¹³å°åœ°å€:        http://192.168.1.100:8080/api/servers/metrics/collect
é‡‡é›†é—´éš”:        60 ç§’
å¯åŠ¨æ—¶é—´:        2025-10-27 23:30:00
======================================================================

2025-10-27 23:30:00,123 - ServerAgent - INFO - é…ç½®åŠ è½½æˆåŠŸ: agent_config.json
2025-10-27 23:30:00,123 - ServerAgent - INFO - Agentå¯åŠ¨æˆåŠŸï¼Œå¼€å§‹ç›‘æ§...
2025-10-27 23:30:00,123 - ServerAgent - INFO - æŒ‰ Ctrl+C åœæ­¢è¿è¡Œ

2025-10-27 23:30:02,456 - ServerAgent - INFO - ==================================================
2025-10-27 23:30:02,456 - ServerAgent - INFO - é‡‡é›†æ—¶é—´: 2025-10-27 23:30:02
2025-10-27 23:30:02,456 - ServerAgent - INFO -   CPUä½¿ç”¨ç‡:    15.2%
2025-10-27 23:30:02,456 - ServerAgent - INFO -   å†…å­˜ä½¿ç”¨ç‡:   48.5%
2025-10-27 23:30:02,456 - ServerAgent - INFO -   ç£ç›˜ä½¿ç”¨ç‡:   62.3%
2025-10-27 23:30:02,456 - ServerAgent - INFO -   å…¥ç½‘æµé‡:     0.01 MB/s
2025-10-27 23:30:02,456 - ServerAgent - INFO -   å‡ºç½‘æµé‡:     0.02 MB/s
2025-10-27 23:30:02,456 - ServerAgent - INFO -   ç³»ç»Ÿè´Ÿè½½:     1.5
2025-10-27 23:30:06,789 - ServerAgent - INFO - âœ“ æŒ‡æ ‡æ¨é€æˆåŠŸ (HTTP 200)
```

**å…³é”®ä¿¡æ¯ï¼š**
- âœ… çœ‹åˆ° "Agentå¯åŠ¨æˆåŠŸ"
- âœ… çœ‹åˆ°ç³»ç»ŸæŒ‡æ ‡ï¼ˆCPUã€å†…å­˜ç­‰ï¼‰
- âœ… **æœ€é‡è¦ï¼šçœ‹åˆ° "âœ“ æŒ‡æ ‡æ¨é€æˆåŠŸ (HTTP 200)"**

#### å¦‚æœçœ‹åˆ°é”™è¯¯

**é”™è¯¯1: è¿æ¥å¤±è´¥**
```
âœ— è¿æ¥å¤±è´¥ - æ— æ³•è¿æ¥åˆ°å¹³å°
```

**åŸå› å’Œè§£å†³ï¼š**
1. æ£€æŸ¥ `platform_url` ä¸­çš„IPæ˜¯å¦æ­£ç¡®
2. åœ¨ç›®æ ‡ç”µè„‘æµ‹è¯•è¿æ¥ï¼š
```cmd
ping 192.168.1.100
curl http://192.168.1.100:8080/actuator/health
```
3. æ£€æŸ¥ç›‘æ§å¹³å°çš„åç«¯æ˜¯å¦è¿è¡Œ
4. æ£€æŸ¥é˜²ç«å¢™

**é”™è¯¯2: 401 Unauthorized**
```
âœ— æ¨é€å¤±è´¥: HTTP 401
```

**åŸå› å’Œè§£å†³ï¼š**
- åç«¯çš„ `WebConfig.java` æ²¡æœ‰æ’é™¤Agentæ¥å£
- éœ€è¦åœ¨ç›‘æ§å¹³å°é‡å¯åç«¯
- ç¡®è®¤ `WebConfig.java` ä¸­æœ‰ï¼š
```java
.excludePathPatterns("/api/servers/metrics/collect")
```

**é”™è¯¯3: 404 Not Found**
```
âœ— æ¨é€å¤±è´¥: HTTP 404
```

**åŸå› å’Œè§£å†³ï¼š**
- URLè·¯å¾„é”™è¯¯
- ç¡®è®¤ `platform_url` æ˜¯ï¼š
```
http://192.168.1.100:8080/api/servers/metrics/collect
```
æ³¨æ„ï¼š
- `servers` æœ‰s
- `metrics` æœ‰s
- `collect` æ‹¼å†™æ­£ç¡®

---

### ğŸ”¹ æ­¥éª¤6ï¼šåå°è¿è¡ŒAgent

æµ‹è¯•æˆåŠŸåï¼Œå¯ä»¥è®©Agentåœ¨åå°è¿è¡Œã€‚

#### Windows - ä½¿ç”¨å¯åŠ¨è„šæœ¬

**æ–¹æ³•Aï¼šåŒå‡»è¿è¡Œ**

åŒå‡» `start_agent_windows.bat`

**æ–¹æ³•Bï¼šæœ€å°åŒ–çª—å£è¿è¡Œ**

1. åˆ›å»ºå¿«æ·æ–¹å¼åˆ° `start_agent_windows.bat`
2. å³é”®å¿«æ·æ–¹å¼ â†’ å±æ€§
3. è¿è¡Œæ–¹å¼ï¼š**æœ€å°åŒ–**
4. ç¡®å®š
5. åŒå‡»å¿«æ·æ–¹å¼å¯åŠ¨

**æ–¹æ³•Cï¼šå®Œå…¨åå°è¿è¡Œï¼ˆæ— çª—å£ï¼‰**

```powershell
Start-Process python -ArgumentList "server_agent.py" -WindowStyle Hidden -WorkingDirectory "C:\agent\agent-deployment-package"
```

**æŸ¥çœ‹åå°è¿›ç¨‹ï¼š**
```powershell
Get-Process python
```

**åœæ­¢åå°è¿›ç¨‹ï¼š**
```powershell
Get-Process python | Stop-Process
```

#### Linux - åå°è¿è¡Œ

**æ–¹æ³•Aï¼šä½¿ç”¨nohup**

```bash
nohup python3 server_agent.py > agent.log 2>&1 &
```

**æŸ¥çœ‹æ—¥å¿—ï¼š**
```bash
tail -f agent.log
```

**æŸ¥çœ‹è¿›ç¨‹ï¼š**
```bash
ps aux | grep server_agent
```

**åœæ­¢è¿›ç¨‹ï¼š**
```bash
pkill -f server_agent.py
```

**æ–¹æ³•Bï¼šä½¿ç”¨systemdæœåŠ¡ï¼ˆæ¨èï¼‰**

1. åˆ›å»ºæœåŠ¡æ–‡ä»¶ï¼š
```bash
sudo nano /etc/systemd/system/server-agent.service
```

2. ç²˜è´´å†…å®¹ï¼š
```ini
[Unit]
Description=Server Monitoring Agent
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/opt/agent/agent-deployment-package
ExecStart=/usr/bin/python3 /opt/agent/agent-deployment-package/server_agent.py
Restart=always
RestartSec=10
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
```

3. å¯ç”¨å¹¶å¯åŠ¨æœåŠ¡ï¼š
```bash
sudo systemctl daemon-reload
sudo systemctl enable server-agent
sudo systemctl start server-agent
```

4. æŸ¥çœ‹çŠ¶æ€ï¼š
```bash
sudo systemctl status server-agent
```

5. æŸ¥çœ‹æ—¥å¿—ï¼š
```bash
journalctl -u server-agent -f
```

---

## âœ… éªŒè¯å’Œæµ‹è¯•

ç°åœ¨éœ€è¦éªŒè¯æ•°æ®æ˜¯å¦æˆåŠŸå†™å…¥åˆ°ç›‘æ§å¹³å°ã€‚

### ğŸ”¹ åœ¨ç›®æ ‡ç”µè„‘ä¸ŠéªŒè¯

#### æŸ¥çœ‹Agentè¿è¡ŒçŠ¶æ€

**Windows:**
```powershell
Get-Process python
```

åº”è¯¥çœ‹åˆ°Pythonè¿›ç¨‹åœ¨è¿è¡Œã€‚

#### æŸ¥çœ‹Agentè¾“å‡º

å¦‚æœæ˜¯å‰å°è¿è¡Œï¼Œç›´æ¥çœ‹ç»ˆç«¯è¾“å‡ºï¼Œåº”è¯¥æ¯60ç§’çœ‹åˆ°ï¼š
```
âœ“ æŒ‡æ ‡æ¨é€æˆåŠŸ (HTTP 200)
```

---

### ğŸ”¹ åœ¨ç›‘æ§å¹³å°ä¸ŠéªŒè¯

å›åˆ°ä½ çš„ç”µè„‘ï¼ˆç›‘æ§å¹³å°ï¼‰è¿›è¡ŒéªŒè¯ã€‚

#### æ–¹æ³•Aï¼šä½¿ç”¨Swagger UI

1. è®¿é—® `http://localhost:8080/swagger-ui.html`

2. ç™»å½•ï¼ˆå¦‚æœä¹‹å‰çš„tokenè¿‡æœŸäº†ï¼‰

3. æ‰¾åˆ° **GET /api/servers/{serverId}/metrics/latest**

4. ç‚¹å‡» **"Try it out"**

5. è¾“å…¥ `serverId`: **2** ï¼ˆç›®æ ‡ç”µè„‘çš„Server IDï¼‰

6. ç‚¹å‡» **"Execute"**

7. æŸ¥çœ‹å“åº”ï¼š
```json
{
  "metricId": 136800,
  "serverId": 2,
  "cpuUsage": 15.2,
  "memoryUsage": 48.5,
  "diskUsage": 62.3,
  "networkIn": 0.01,
  "networkOut": 0.02,
  "loadAvg": 1.5,
  "temperature": null,
  "collectedAt": "2025-10-27T23:30:02.456789"
}
```

**æˆåŠŸæ ‡å¿—ï¼š**
- âœ… `serverId` æ˜¯ç›®æ ‡ç”µè„‘çš„IDï¼ˆ2ï¼‰
- âœ… æœ‰CPUã€å†…å­˜ç­‰æ•°æ®
- âœ… `collectedAt` æ—¶é—´æ˜¯æœ€è¿‘çš„

#### æ–¹æ³•Bï¼šä½¿ç”¨PowerShell

```powershell
# ç™»å½•
$login = Invoke-RestMethod -Uri "http://localhost:8080/api/auth/signin" `
    -Method Post -ContentType "application/json" `
    -Body '{"username":"admin","password":"admin123"}'

$token = $login.token
$headers = @{"Authorization" = "Bearer $token"}

# æŸ¥è¯¢æœ€æ–°æ•°æ®
$latest = Invoke-RestMethod -Uri "http://localhost:8080/api/servers/2/metrics/latest" `
    -Method Get -Headers $headers

# æ ¼å¼åŒ–æ˜¾ç¤º
Write-Host "`nç›®æ ‡ç”µè„‘çš„æœ€æ–°æŒ‡æ ‡:" -ForegroundColor Cyan
Write-Host "=====================" -ForegroundColor Cyan
Write-Host "Server ID:     $($latest.serverId)" -ForegroundColor White
Write-Host "CPUä½¿ç”¨ç‡:     $($latest.cpuUsage)%" -ForegroundColor Yellow
Write-Host "å†…å­˜ä½¿ç”¨ç‡:    $($latest.memoryUsage)%" -ForegroundColor Yellow
Write-Host "ç£ç›˜ä½¿ç”¨ç‡:    $($latest.diskUsage)%" -ForegroundColor Yellow
Write-Host "å…¥ç½‘æµé‡:      $($latest.networkIn) MB/s" -ForegroundColor Yellow
Write-Host "å‡ºç½‘æµé‡:      $($latest.networkOut) MB/s" -ForegroundColor Yellow
Write-Host "é‡‡é›†æ—¶é—´:      $($latest.collectedAt)" -ForegroundColor Gray
Write-Host "=====================`n" -ForegroundColor Cyan

# æŸ¥è¯¢å†å²æ•°æ®ï¼ˆæœ€è¿‘10æ¡ï¼‰
$history = Invoke-RestMethod -Uri "http://localhost:8080/api/servers/2/metrics?limit=10" `
    -Method Get -Headers $headers

Write-Host "å†å²æ•°æ®è®°å½•æ•°: $($history.Count)" -ForegroundColor Green
```

#### æ–¹æ³•Cï¼šç›´æ¥æŸ¥è¯¢æ•°æ®åº“

```sql
-- æŸ¥çœ‹æœ€æ–°æ•°æ®
SELECT * FROM server_metrics 
WHERE server_id = 2 
ORDER BY collected_at DESC 
LIMIT 1;

-- æŸ¥çœ‹æœ€è¿‘10æ¡è®°å½•
SELECT 
    metric_id,
    server_id,
    cpu_usage,
    memory_usage,
    disk_usage,
    collected_at
FROM server_metrics 
WHERE server_id = 2 
ORDER BY collected_at DESC 
LIMIT 10;

-- ç»Ÿè®¡æ•°æ®æ¡æ•°
SELECT COUNT(*) as total_records 
FROM server_metrics 
WHERE server_id = 2;
```

#### æ–¹æ³•Dï¼šåœ¨å‰ç«¯DashboardæŸ¥çœ‹

1. è®¿é—® `http://localhost:3000`ï¼ˆå¦‚æœå‰ç«¯å·²å¯åŠ¨ï¼‰
2. ç™»å½•
3. è¿›å…¥Dashboardæˆ–Serversé¡µé¢
4. åº”è¯¥èƒ½çœ‹åˆ°ç›®æ ‡ç”µè„‘ï¼ˆServer ID: 2ï¼‰çš„å®æ—¶æŒ‡æ ‡

---

## ğŸ” å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜1ï¼šAgentæ˜¾ç¤º"è¿æ¥å¤±è´¥"

**å®Œæ•´æ’æŸ¥æ­¥éª¤ï¼š**

#### 1.1 æ£€æŸ¥ç›®æ ‡ç”µè„‘ç½‘ç»œ

åœ¨ç›®æ ‡ç”µè„‘ä¸Šï¼š
```cmd
ping 192.168.1.100
```

**å¦‚æœpingä¸é€šï¼š**
- æ£€æŸ¥ä¸¤å°ç”µè„‘æ˜¯å¦åœ¨åŒä¸€ç½‘ç»œ
- æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
- å°è¯•pingç½‘å…³ï¼š`ping 192.168.1.1`

#### 1.2 æ£€æŸ¥ç«¯å£è¿é€šæ€§

```powershell
Test-NetConnection -ComputerName 192.168.1.100 -Port 8080
```

**å¦‚æœç«¯å£ä¸é€šï¼š**
- æ£€æŸ¥ç›‘æ§å¹³å°çš„é˜²ç«å¢™
- æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œåœ¨8080ç«¯å£

#### 1.3 æ£€æŸ¥HTTPè®¿é—®

```cmd
curl http://192.168.1.100:8080/actuator/health
```

**æœŸæœ›ç»“æœï¼š**
- è¿”å›200æˆ–403ï¼ˆéƒ½è¯´æ˜èƒ½è®¿é—®ï¼‰
- ä¸åº”è¯¥æ˜¯"è¿æ¥å¤±è´¥"

#### 1.4 æ£€æŸ¥é…ç½®æ–‡ä»¶

```cmd
type agent_config.json
```

ç¡®è®¤ï¼š
- IPåœ°å€æ­£ç¡®
- ç«¯å£æ˜¯8080
- è·¯å¾„æ˜¯ `/api/servers/metrics/collect`

---

### é—®é¢˜2ï¼šAgentæ˜¾ç¤º"401 Unauthorized"

**å®Œæ•´è§£å†³æ­¥éª¤ï¼š**

#### 2.1 æ£€æŸ¥WebConfigé…ç½®

åœ¨ç›‘æ§å¹³å°ä¸Šï¼Œæ£€æŸ¥ `backend/src/main/java/com/elec5619/backend/config/WebConfig.java`ï¼š

```java
@Override
public void addInterceptors(InterceptorRegistry registry) {
    registry.addInterceptor(jwtInterceptor)
            .addPathPatterns("/api/**")
            .excludePathPatterns(
                "/api/auth/**",
                "/api/servers/metrics/collect",  // <-- å¿…é¡»æœ‰è¿™ä¸€è¡Œï¼
                "/swagger-ui/**",
                "/v3/api-docs/**",
                "/api-docs/**"
            );
}
```

#### 2.2 é‡å¯åç«¯

ä¿®æ”¹é…ç½®åï¼Œå¿…é¡»é‡å¯åç«¯ï¼š

```powershell
# åœæ­¢åç«¯ï¼ˆCtrl+Cï¼‰
# é‡æ–°å¯åŠ¨
cd D:\5619\ELEC5619-03-Group-1\backend
.\mvnw.cmd spring-boot:run
```

#### 2.3 éªŒè¯é…ç½®ç”Ÿæ•ˆ

åœ¨ç›‘æ§å¹³å°ä¸Šæµ‹è¯•ï¼š
```powershell
$testData = '{"serverId":1,"cpuUsage":10.0}'
Invoke-RestMethod -Uri "http://localhost:8080/api/servers/metrics/collect" `
    -Method Post -Body $testData -ContentType "application/json"
```

åº”è¯¥æˆåŠŸï¼Œä¸å†è¿”å›401ã€‚

#### 2.4 Agenté‡è¯•

Agentä¼šæ¯60ç§’è‡ªåŠ¨é‡è¯•ï¼Œç­‰å¾…ä¸‹ä¸€ä¸ªå‘¨æœŸå³å¯çœ‹åˆ°æˆåŠŸã€‚

---

### é—®é¢˜3ï¼šæ•°æ®æ²¡æœ‰å‡ºç°åœ¨æ•°æ®åº“

**å®Œæ•´æ’æŸ¥æ­¥éª¤ï¼š**

#### 3.1 ç¡®è®¤Agentæ¨é€æˆåŠŸ

åœ¨ç›®æ ‡ç”µè„‘çš„Agentè¾“å‡ºä¸­ï¼Œå¿…é¡»çœ‹åˆ°ï¼š
```
âœ“ æŒ‡æ ‡æ¨é€æˆåŠŸ (HTTP 200)
```

#### 3.2 æ£€æŸ¥Server IDæ˜¯å¦å­˜åœ¨

åœ¨ç›‘æ§å¹³å°ä¸Šï¼š
```powershell
# ç™»å½•
$login = Invoke-RestMethod -Uri "http://localhost:8080/api/auth/signin" `
    -Method Post -ContentType "application/json" `
    -Body '{"username":"admin","password":"admin123"}'

$token = $login.token
$headers = @{"Authorization" = "Bearer $token"}

# æŸ¥è¯¢æœåŠ¡å™¨æ˜¯å¦å­˜åœ¨
$server = Invoke-RestMethod -Uri "http://localhost:8080/api/servers/2" `
    -Method Get -Headers $headers

$server
```

**å¦‚æœè¿”å›404ï¼Œè¯´æ˜Server IDä¸å­˜åœ¨ï¼Œéœ€è¦é‡æ–°åˆ›å»ºã€‚**

#### 3.3 æŸ¥çœ‹åç«¯æ—¥å¿—

åœ¨åç«¯æ—¥å¿—ä¸­æœç´¢ï¼š
```
POST /api/servers/metrics/collect
```

åº”è¯¥çœ‹åˆ°æˆåŠŸçš„è¯·æ±‚è®°å½•ã€‚

#### 3.4 ç›´æ¥æŸ¥è¯¢æ•°æ®åº“

```sql
SELECT COUNT(*) FROM server_metrics WHERE server_id = 2;
```

å¦‚æœæ˜¯0ï¼Œè¯´æ˜ç¡®å®æ²¡æœ‰æ•°æ®ã€‚

---

### é—®é¢˜4ï¼šå¤šå°ç”µè„‘éƒ¨ç½²

**å¦‚æœè¦éƒ¨ç½²åˆ°å¤šå°ç”µè„‘ï¼š**

#### 4.1 æ‰¹é‡åˆ›å»ºæœåŠ¡å™¨è®°å½•

```powershell
# ç™»å½•
$login = Invoke-RestMethod -Uri "http://localhost:8080/api/auth/signin" `
    -Method Post -ContentType "application/json" `
    -Body '{"username":"admin","password":"admin123"}'

$token = $login.token
$headers = @{"Authorization" = "Bearer $token"; "Content-Type" = "application/json"}

# åˆ›å»ºå¤šå°æœåŠ¡å™¨
$servers = @(
    @{serverName="Remote-PC-01"; ipAddress="192.168.1.201"},
    @{serverName="Remote-PC-02"; ipAddress="192.168.1.202"},
    @{serverName="Remote-PC-03"; ipAddress="192.168.1.203"}
)

foreach ($serverInfo in $servers) {
    $serverData = @{
        serverName = $serverInfo.serverName
        ipAddress = $serverInfo.ipAddress
        status = "unknown"
    } | ConvertTo-Json
    
    $newServer = Invoke-RestMethod -Uri "http://localhost:8080/api/servers" `
        -Method Post -Headers $headers -Body $serverData
    
    Write-Host "$($serverInfo.serverName): Server ID = $($newServer.id)" -ForegroundColor Green
}
```

è®°ä¸‹æ¯å°ç”µè„‘çš„Server IDã€‚

#### 4.2 ä¸ºæ¯å°ç”µè„‘ç”Ÿæˆéƒ¨ç½²åŒ…

```powershell
# ä¸ºServer ID 2ç”Ÿæˆ
.\create_deployment_package.ps1
# è¾“å…¥IP: 192.168.1.100
# è¾“å…¥Server ID: 2

# ä¸ºServer ID 3ç”Ÿæˆ
.\create_deployment_package.ps1
# è¾“å…¥IP: 192.168.1.100
# è¾“å…¥Server ID: 3

# ...
```

æˆ–æ‰‹åŠ¨ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ `server_id`ã€‚

---

## ğŸ“ éƒ¨ç½²æ£€æŸ¥æ¸…å•

### åœ¨ç›‘æ§å¹³å°ï¼ˆä½ çš„ç”µè„‘ï¼‰

- [ ] çŸ¥é“è‡ªå·±çš„IPåœ°å€
- [ ] é˜²ç«å¢™å·²å¼€æ”¾8080ç«¯å£
- [ ] åç«¯æ­£åœ¨è¿è¡Œ
- [ ] èƒ½è®¿é—® http://localhost:8080
- [ ] åœ¨å¹³å°åˆ›å»ºäº†æœåŠ¡å™¨è®°å½•
- [ ] è®°ä¸‹äº†Server ID
- [ ] åˆ›å»ºäº†éƒ¨ç½²åŒ…
- [ ] ä»ç›®æ ‡ç”µè„‘èƒ½pingé€šä½ çš„IP
- [ ] ä»ç›®æ ‡ç”µè„‘èƒ½è®¿é—® http://ä½ çš„IP:8080

### åœ¨ç›®æ ‡ç”µè„‘

- [ ] Pythonå·²å®‰è£…ï¼ˆ3.8+ï¼‰
- [ ] psutilå’Œrequestså·²å®‰è£…
- [ ] éƒ¨ç½²åŒ…å·²å¤åˆ¶åˆ°æœ¬åœ°
- [ ] agent_config.jsoné…ç½®æ­£ç¡®
- [ ] Agentèƒ½æ­£å¸¸å¯åŠ¨
- [ ] çœ‹åˆ°"æ¨é€æˆåŠŸ"çš„æ¶ˆæ¯
- [ ] ç›‘æ§å¹³å°èƒ½æŸ¥åˆ°æ•°æ®

---

## ğŸ‰ æˆåŠŸæ ‡å¿—

å½“ä½ çœ‹åˆ°ä»¥ä¸‹æƒ…å†µï¼Œè¯´æ˜éƒ¨ç½²å®Œå…¨æˆåŠŸï¼š

### åœ¨ç›®æ ‡ç”µè„‘ä¸Š
```
âœ“ æŒ‡æ ‡æ¨é€æˆåŠŸ (HTTP 200)
```

### åœ¨ç›‘æ§å¹³å°ä¸Š
```powershell
# èƒ½æŸ¥åˆ°æœ€æ–°æ•°æ®
$latest = Invoke-RestMethod -Uri "http://localhost:8080/api/servers/2/metrics/latest" ...
$latest.cpuUsage  # æœ‰å€¼ï¼
```

### åœ¨æ•°æ®åº“ä¸­
```sql
SELECT COUNT(*) FROM server_metrics WHERE server_id = 2;
-- ç»“æœ > 0
```

---

**æ­å–œï¼ä½ å·²ç»æˆåŠŸåœ¨è¿œç¨‹ç”µè„‘ä¸Šéƒ¨ç½²äº†ç›‘æ§Agentï¼** ğŸŠ

ç°åœ¨ç³»ç»Ÿä¼šï¼š
- â° æ¯60ç§’è‡ªåŠ¨é‡‡é›†ç›®æ ‡ç”µè„‘çš„ç³»ç»ŸæŒ‡æ ‡
- ğŸ“¡ è‡ªåŠ¨æ¨é€åˆ°ä½ çš„ç›‘æ§å¹³å°
- ğŸ’¾ è‡ªåŠ¨ä¿å­˜åˆ°æ•°æ®åº“
- ğŸ“Š åœ¨Dashboardä¸Šå®æ—¶æ˜¾ç¤º

**ç›‘æ§ç³»ç»Ÿå·²ä¸Šçº¿ï¼** ğŸš€

